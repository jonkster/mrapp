"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var permissions_service_1 = require("../permissions.service");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var dialogs = require("ui/dialogs");
var UserAdminComponent = /** @class */ (function () {
    function UserAdminComponent(route, routerExtensions, permissionsService) {
        this.route = route;
        this.routerExtensions = routerExtensions;
        this.permissionsService = permissionsService;
        this.user = '';
        this.group = '';
        this.pw = '';
        this.changingPw = false;
        this.activity = false;
        this.user = this.permissionsService.getCurrentUser();
        this.group = this.permissionsService.getClassOfUser(this.user);
    }
    UserAdminComponent.prototype.ngOnInit = function () {
        var id = this.route.snapshot.params["id"];
        if (id !== undefined) {
            this.user = id;
            this.group = this.permissionsService.getClassOfUser(this.user);
        }
        else {
            if (this.group === 'admin') {
                this.pickUser();
            }
        }
    };
    UserAdminComponent.prototype.can = function (action) {
        return this.permissionsService.can(action);
    };
    UserAdminComponent.prototype.savePassword = function () {
        this.permissionsService.setUserPw(this.user, this.pw);
        this.changingPw = false;
    };
    UserAdminComponent.prototype.userSpecified = function (ev) {
        var userControl = ev.object;
        var user = userControl.text;
        if (this.permissionsService.userExists(user)) {
        }
        else {
            dialogs.confirm({
                title: "Add User",
                message: user + " is not known - do you want to add as new user?",
                okButtonText: "Add User",
                cancelButtonText: "Cancel",
            }).then(function (result) {
                if (result) {
                }
            });
        }
    };
    UserAdminComponent.prototype.changePassword = function () {
        this.changingPw = true;
    };
    UserAdminComponent.prototype.deleteUser = function () {
        var _this = this;
        if (this.user !== 'admin') {
            dialogs.confirm({
                title: "Delete User: " + this.user,
                message: "If you enter Delete, " + this.user + " WILL BE DELETED!",
                okButtonText: "Keep " + this.user,
                cancelButtonText: "Delete",
            }).then(function (result) {
                if (!result) {
                    _this.permissionsService.deleteUser(_this.user);
                    alert('user ' + _this.user + ' deleted');
                    _this.routerExtensions.navigate(["/fleet"], { clearHistory: true });
                }
            });
        }
        else {
            alert("cannot remove admin account");
        }
    };
    UserAdminComponent.prototype.changeClass = function () {
        var _this = this;
        if (this.user !== 'admin') {
            dialogs.action({
                title: "User Category",
                message: "Select User category for " + this.user,
                cancelButtonText: "Cancel",
                actions: ["Admin", "Maintainer", "Pilot", "Read Only"]
            }).then(function (c) {
                if (c === "Read Only") {
                    c = 'default';
                }
                else if (c === "Pilot") {
                    c = 'pilot';
                }
                else if (c === "Maintainer") {
                    c = 'maintainer';
                }
                else if (c === "Admin") {
                    c = 'admin';
                }
                _this.permissionsService.setUserClass(_this.user, c);
                _this.routerExtensions.navigate(["userAdmin", _this.user], { clearHistory: true });
            });
        }
        else {
            alert("cannot change admin account");
        }
    };
    UserAdminComponent.prototype.pickUser = function () {
        var _this = this;
        var userNames = this.permissionsService.getUserNames();
        dialogs.action({
            title: "Select User",
            message: "Select User to Edit",
            cancelButtonText: "Cancel",
            actions: userNames
        }).then(function (c) {
            if (c === "Read Only") {
                c = 'default';
            }
            else if (c === "Pilot") {
                c = 'pilot';
            }
            else if (c === "Maintainer") {
                c = 'maintainer';
            }
            else if (c === "Admin") {
                c = 'admin';
            }
            _this.user = c;
            _this.routerExtensions.navigate(["userAdmin", _this.user], { clearHistory: true });
        });
    };
    UserAdminComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'app-user-admin',
            templateUrl: './user-admin.component.html',
            styleUrls: ['./user-admin.component.scss']
        }),
        __metadata("design:paramtypes", [router_1.ActivatedRoute,
            router_2.RouterExtensions,
            permissions_service_1.PermissionsService])
    ], UserAdminComponent);
    return UserAdminComponent;
}());
exports.UserAdminComponent = UserAdminComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1hZG1pbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1c2VyLWFkbWluLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFrRDtBQUVsRCw4REFBNEQ7QUFDNUQsMENBQWlEO0FBQ2pELHNEQUErRDtBQUUvRCxvQ0FBc0M7QUFRdEM7SUFPUSw0QkFBb0IsS0FBcUIsRUFDakIsZ0JBQWtDLEVBQ2xDLGtCQUFzQztRQUYxQyxVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUNqQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFSdEQsU0FBSSxHQUFXLEVBQUUsQ0FBQztRQUNsQixVQUFLLEdBQVcsRUFBRSxDQUFDO1FBQ25CLE9BQUUsR0FBVyxFQUFFLENBQUM7UUFDaEIsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUM1QixhQUFRLEdBQVksS0FBSyxDQUFDO1FBTTFCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3JELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVGLHFDQUFRLEdBQVI7UUFDUSxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkUsQ0FBQztRQUFDLElBQUksQ0FB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QztDQUFBLEFBNUhELElBNEhDO0FBNUhZLGdEQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUZXh0RmllbGQgfSBmcm9tIFwidWkvdGV4dC1maWVsZFwiO1xuaW1wb3J0IHsgUGVybWlzc2lvbnNTZXJ2aWNlIH0gZnJvbSBcIi4uL3Blcm1pc3Npb25zLnNlcnZpY2VcIjtcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcblxuaW1wb3J0ICogYXMgZGlhbG9ncyBmcm9tIFwidWkvZGlhbG9nc1wiO1xuXG5AQ29tcG9uZW50KHtcbiAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcbiAgc2VsZWN0b3I6ICdhcHAtdXNlci1hZG1pbicsXG4gIHRlbXBsYXRlVXJsOiAnLi91c2VyLWFkbWluLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdXNlci1hZG1pbi5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFVzZXJBZG1pbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgICAgIHByaXZhdGUgdXNlcjogc3RyaW5nID0gJyc7XG4gICAgICAgIHByaXZhdGUgZ3JvdXA6IHN0cmluZyA9ICcnO1xuICAgICAgICBwcml2YXRlIHB3OiBzdHJpbmcgPSAnJztcbiAgICAgICAgcHJpdmF0ZSBjaGFuZ2luZ1B3OiBib29sZWFuID0gZmFsc2U7XG4gICAgICAgIHByaXZhdGUgYWN0aXZpdHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgcm91dGVyRXh0ZW5zaW9uczogUm91dGVyRXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgcGVybWlzc2lvbnNTZXJ2aWNlOiBQZXJtaXNzaW9uc1NlcnZpY2UpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudXNlciA9IHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cCA9IHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLmdldENsYXNzT2ZVc2VyKHRoaXMudXNlcik7XG4gICAgICAgICB9IFxuXG4gICAgICAgIG5nT25Jbml0KCkgeyBcbiAgICAgICAgICAgICAgICBjb25zdCBpZCA9IHRoaXMucm91dGUuc25hcHNob3QucGFyYW1zW1wiaWRcIl07XG4gICAgICAgICAgICAgICAgaWYgKGlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlciA9IGlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm91cCA9IHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLmdldENsYXNzT2ZVc2VyKHRoaXMudXNlcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdyb3VwID09PSAnYWRtaW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGlja1VzZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjYW4oYWN0aW9uOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLmNhbihhY3Rpb24pO1xuICAgICAgICB9XG5cblxuICBzYXZlUGFzc3dvcmQoKSB7XG4gICAgICAgIHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLnNldFVzZXJQdyh0aGlzLnVzZXIsIHRoaXMucHcpO1xuICAgICAgICB0aGlzLmNoYW5naW5nUHcgPSBmYWxzZTtcbiAgfVxuXG4gIHVzZXJTcGVjaWZpZWQoZXYpIHtcbiAgICAgICAgbGV0IHVzZXJDb250cm9sID0gPFRleHRGaWVsZD5ldi5vYmplY3Q7XG4gICAgICAgIGxldCB1c2VyID0gdXNlckNvbnRyb2wudGV4dDtcbiAgICAgICAgaWYgKHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLnVzZXJFeGlzdHModXNlcikpIHtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkaWFsb2dzLmNvbmZpcm0oe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiQWRkIFVzZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHVzZXIgKyBcIiBpcyBub3Qga25vd24gLSBkbyB5b3Ugd2FudCB0byBhZGQgYXMgbmV3IHVzZXI/XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBva0J1dHRvblRleHQ6IFwiQWRkIFVzZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICB9XG5cbiAgY2hhbmdlUGFzc3dvcmQoKSB7XG4gICAgICAgIHRoaXMuY2hhbmdpbmdQdyA9IHRydWU7XG4gIH1cblxuICBkZWxldGVVc2VyKCkge1xuICAgICAgICBpZiAodGhpcy51c2VyICE9PSAnYWRtaW4nKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9ncy5jb25maXJtKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZSBVc2VyOiBcIiArIHRoaXMudXNlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSWYgeW91IGVudGVyIERlbGV0ZSwgXCIgKyB0aGlzLnVzZXIgKyBcIiBXSUxMIEJFIERFTEVURUQhXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBva0J1dHRvblRleHQ6IFwiS2VlcCBcIiArIHRoaXMudXNlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEgcmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZXJtaXNzaW9uc1NlcnZpY2UuZGVsZXRlVXNlcih0aGlzLnVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCd1c2VyICcgKyB0aGlzLnVzZXIgKyAnIGRlbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdXRlckV4dGVuc2lvbnMubmF2aWdhdGUoW1wiL2ZsZWV0XCJdLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJjYW5ub3QgcmVtb3ZlIGFkbWluIGFjY291bnRcIik7XG4gICAgICAgIH1cbiAgfVxuXG4gIGNoYW5nZUNsYXNzKCkge1xuICAgICAgICBpZiAodGhpcy51c2VyICE9PSAnYWRtaW4nKSB7XG4gICAgICAgICAgZGlhbG9ncy5hY3Rpb24oe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlVzZXIgQ2F0ZWdvcnlcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIlNlbGVjdCBVc2VyIGNhdGVnb3J5IGZvciBcIiArIHRoaXMudXNlcixcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgIGFjdGlvbnM6IFtcIkFkbWluXCIsIFwiTWFpbnRhaW5lclwiLCBcIlBpbG90XCIsIFwiUmVhZCBPbmx5XCJdXG4gICAgICAgICAgICAgICAgfSkudGhlbigoYykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT09IFwiUmVhZCBPbmx5XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICdkZWZhdWx0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gXCJQaWxvdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAncGlsb3QnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09PSBcIk1haW50YWluZXJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gJ21haW50YWluZXInO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09PSBcIkFkbWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICdhZG1pbic7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zU2VydmljZS5zZXRVc2VyQ2xhc3ModGhpcy51c2VyLCBjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyRXh0ZW5zaW9ucy5uYXZpZ2F0ZShbXCJ1c2VyQWRtaW5cIiwgdGhpcy51c2VyXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhbGVydChcImNhbm5vdCBjaGFuZ2UgYWRtaW4gYWNjb3VudFwiKTtcbiAgICAgICAgfVxuICB9XG5cbiAgcGlja1VzZXIoKSB7XG4gICAgICAgICBsZXQgdXNlck5hbWVzID0gdGhpcy5wZXJtaXNzaW9uc1NlcnZpY2UuZ2V0VXNlck5hbWVzKCk7XG4gICAgICAgICBkaWFsb2dzLmFjdGlvbih7XG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiU2VsZWN0IFVzZXJcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIlNlbGVjdCBVc2VyIHRvIEVkaXRcIixcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkNhbmNlbFwiLFxuICAgICAgICAgICAgICAgIGFjdGlvbnM6IHVzZXJOYW1lc1xuICAgICAgICAgICAgICAgIH0pLnRoZW4oKGMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID09PSBcIlJlYWQgT25seVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAnZGVmYXVsdCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGMgPT09IFwiUGlsb3RcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gJ3BpbG90JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gXCJNYWludGFpbmVyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICdtYWludGFpbmVyJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gXCJBZG1pblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAnYWRtaW4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyID0gYztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVyRXh0ZW5zaW9ucy5uYXZpZ2F0ZShbXCJ1c2VyQWRtaW5cIiwgdGhpcy51c2VyXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgfVxuXG59XG4iXX0=