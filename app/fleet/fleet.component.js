"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var page_1 = require("ui/page");
var angular_1 = require("nativescript-ui-sidedrawer/angular");
var app_component_1 = require("../app.component");
var fleet_service_1 = require("../common/fleet.service");
var permissions_service_1 = require("../permissions.service");
var router_1 = require("nativescript-angular/router");
var dialogs = require("ui/dialogs");
var FleetComponent = /** @class */ (function () {
    function FleetComponent(_changeDetectionRef, page, routerExtensions, permissionsService, appComponent, fleetService) {
        this._changeDetectionRef = _changeDetectionRef;
        this.page = page;
        this.routerExtensions = routerExtensions;
        this.permissionsService = permissionsService;
        this.appComponent = appComponent;
        this.fleetService = fleetService;
        this.sortOrder = 'alphabetic';
        this.acStatusDetails = {};
        this.acStatus = {};
        this.readyToShow = false;
    }
    FleetComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.update();
        this.page.on('navigatingTo', function (data) {
            _this.update();
            _this.readyToShow = true;
        });
    };
    FleetComponent.prototype.update = function () {
        this.fleet = this.fleetService.getFleet();
        this.changeSortOrder();
        for (var i = 0; i < this.fleet.length; i++) {
            var ac = this.fleet[i];
            this.acStatusDetails[ac.rego] = this.fleetService.getAircraftStatusItems(ac);
            this.acStatus[ac.rego] = this.fleetService.getStatus(ac.rego);
        }
    };
    FleetComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.drawer = this.drawerComponent.sideDrawer;
        this._changeDetectionRef.detectChanges();
        // a little delay so the spinner has time to show up
        setTimeout(function () {
            _this.readyToShow = true;
        }, 1000);
    };
    FleetComponent.prototype.isAdminAccess = function () {
        return this.permissionsService.isAdminAccess();
    };
    FleetComponent.prototype.can = function (action) {
        return this.permissionsService.can(action);
    };
    FleetComponent.prototype.changeSortOrder = function () {
        if (this.sortOrder === 'type') {
            this.fleet.sort(function (a, b) {
                if (a.type < b.type) {
                    return -1;
                }
                else if (a.type > b.type) {
                    return 1;
                }
                else if (a.rego < b.rego) {
                    return -1;
                }
                else if (a.rego > b.rego) {
                    return 1;
                }
                else {
                    return 0;
                }
            });
        }
        else if (this.sortOrder === 'alphabetic') {
            this.fleet.sort(function (a, b) {
                if (a.rego < b.rego) {
                    return -1;
                }
                else if (a.rego > b.rego) {
                    return 1;
                }
                else {
                    return 0;
                }
            });
        }
    };
    FleetComponent.prototype.getDaysLeft = function (ac) {
        return this.fleetService.getDaysLeft(ac);
    };
    FleetComponent.prototype.getHrsLeft = function (ac) {
        var hrs = ac.hrsAtMaint - this.getTtis(ac);
        return Math.round(hrs * 10) / 10;
    };
    FleetComponent.prototype.getTtis = function (ac) {
        return ac.clockTime + ac.clockOffset;
    };
    FleetComponent.prototype.addAircraft = function () {
        this.routerExtensions.navigate(["newAircraft"], { clearHistory: true });
    };
    FleetComponent.prototype.goToSummary = function () {
        this.readyToShow = false;
        this.routerExtensions.navigate(["summary"], { clearHistory: false });
    };
    FleetComponent.prototype.addUser = function () {
        var _this = this;
        dialogs.login({
            title: "Add New User",
            message: "User",
            userName: "",
            password: "",
            okButtonText: "Add",
            cancelButtonText: "Cancel"
        }).then(function (r) {
            if (r.result) {
                if (_this.permissionsService.userExists(r.userName)) {
                    alert("user: " + r.userName + " already exists");
                    return;
                }
                dialogs.action({
                    title: "User Category",
                    message: "Select User type",
                    cancelButtonText: "Cancel",
                    actions: ["Admin", "Maintainer", "Pilot", "Read Only"]
                }).then(function (c) {
                    if (c === "Read Only") {
                        c = 'default';
                    }
                    else if (c === "Pilot") {
                        c = 'pilot';
                    }
                    else if (c === "Maintainer") {
                        c = 'maintainer';
                    }
                    else if (c === "Admin") {
                        c = 'admin';
                    }
                    _this.permissionsService.addNewUser(r.userName, r.password, c);
                    _this.routerExtensions.navigate(["userAdmin", r.userName], { clearHistory: true });
                });
            }
        });
    };
    FleetComponent.prototype.removeUser = function () {
        this.routerExtensions.navigate(["userAdmin"], { clearHistory: true });
    };
    FleetComponent.prototype.userSettings = function () {
        this.routerExtensions.navigate(["userAdmin"], { clearHistory: true });
    };
    FleetComponent.prototype.logOut = function () {
        this.permissionsService.setUser('default');
        this.routerExtensions.navigate(["./user"], { clearHistory: false });
    };
    FleetComponent.prototype.toggle = function () {
        this.drawer.toggleDrawerState();
    };
    FleetComponent.prototype.toggleOrder = function () {
        if (this.sortOrder === 'type') {
            this.sortOrder = 'alphabetic';
        }
        else if (this.sortOrder === 'alphabetic') {
            this.sortOrder = 'type';
        }
        this.changeSortOrder();
    };
    __decorate([
        core_1.ViewChild(angular_1.RadSideDrawerComponent),
        __metadata("design:type", angular_1.RadSideDrawerComponent)
    ], FleetComponent.prototype, "drawerComponent", void 0);
    FleetComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'app-fleet',
            templateUrl: './fleet.component.html',
            styleUrls: ['./fleet.component.scss']
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef,
            page_1.Page,
            router_1.RouterExtensions,
            permissions_service_1.PermissionsService,
            app_component_1.AppComponent,
            fleet_service_1.FleetService])
    ], FleetComponent);
    return FleetComponent;
}());
exports.FleetComponent = FleetComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxlZXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZmxlZXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQStGO0FBRS9GLGdDQUErQjtBQUcvQiw4REFBNEY7QUFHNUYsa0RBQWdEO0FBRWhELHlEQUF1RDtBQUN2RCw4REFBNEQ7QUFDNUQsc0RBQStEO0FBRS9ELG9DQUFzQztBQVF0QztJQU9RLHdCQUFvQixtQkFBc0MsRUFDbEMsSUFBVSxFQUNWLGdCQUFrQyxFQUNsQyxrQkFBc0MsRUFDdEMsWUFBMEIsRUFDMUIsWUFBMEI7UUFMOUIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFtQjtRQUNsQyxTQUFJLEdBQUosSUFBSSxDQUFNO1FBQ1YscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQ3RDLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBVjFDLGNBQVMsR0FBVyxZQUFZLENBQUM7UUFDakMsb0JBQWUsR0FBUSxFQUFFLENBQUM7UUFDMUIsYUFBUSxHQUFRLEVBQUUsQ0FBQztRQUMxQixnQkFBVyxHQUFHLEtBQUssQ0FBQztJQU9pQyxDQUFDO0lBS3ZELGlDQUFRLEdBQVI7UUFBQSxpQkFNQztRQUxQLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsRUFBRSxVQUFDLElBQUk7WUFDakMsS0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2QsS0FBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDRyxDQUFDO0lBRVIsK0JBQU0sR0FBTjtRQUNlLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMxQyxJQUFJLENBQUMsZUFB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LENBQUM7UUFDdEMsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7UUFDaEMsQ0FBQztRQUNELElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBcEprQztRQUFsQyxnQkFBUyxDQUFDLGdDQUFzQixDQUFDO2tDQUF5QixnQ0FBc0I7MkRBQUM7SUFkN0UsY0FBYztRQU4xQixnQkFBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFFBQVEsRUFBRSxXQUFXO1lBQ3JCLFdBQVcsRUFBRSx3QkFBd0I7WUFDckMsU0FBUyxFQUFFLENBQUMsd0JBQXdCLENBQUM7U0FDdEMsQ0FBQzt5Q0FRK0Msd0JBQWlCO1lBQzVCLFdBQUk7WUFDUSx5QkFBZ0I7WUFDZCx3Q0FBa0I7WUFDeEIsNEJBQVk7WUFDWiw0QkFBWTtPQVo3QyxjQUFjLENBb0sxQjtJQUFELHFCQUFDO0NBQUEsQUFwS0QsSUFvS0M7QUFwS1ksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcInVpL3BhZ2VcIjtcbmltcG9ydCB7IEFjdGlvbkl0ZW0gfSBmcm9tIFwidWkvYWN0aW9uLWJhclwiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJkYXRhL29ic2VydmFibGVcIjtcbmltcG9ydCB7IFJhZFNpZGVEcmF3ZXJDb21wb25lbnQsIFNpZGVEcmF3ZXJUeXBlIH0gZnJvbSAnbmF0aXZlc2NyaXB0LXVpLXNpZGVkcmF3ZXIvYW5ndWxhcic7XG5pbXBvcnQgeyBSYWRTaWRlRHJhd2VyIH0gZnJvbSAnbmF0aXZlc2NyaXB0LXVpLXNpZGVkcmF3ZXInO1xuXG5pbXBvcnQgeyBBcHBDb21wb25lbnQgfSBmcm9tIFwiLi4vYXBwLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgQWlyY3JhZnQgfSBmcm9tIFwiLi4vY29tbW9uL2FpcmNyYWZ0XCI7XG5pbXBvcnQgeyBGbGVldFNlcnZpY2UgfSBmcm9tIFwiLi4vY29tbW9uL2ZsZWV0LnNlcnZpY2VcIjtcbmltcG9ydCB7IFBlcm1pc3Npb25zU2VydmljZSB9IGZyb20gXCIuLi9wZXJtaXNzaW9ucy5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBSb3V0ZXJFeHRlbnNpb25zIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1hbmd1bGFyL3JvdXRlclwiO1xuXG5pbXBvcnQgKiBhcyBkaWFsb2dzIGZyb20gXCJ1aS9kaWFsb2dzXCI7XG5cbkBDb21wb25lbnQoe1xuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICBzZWxlY3RvcjogJ2FwcC1mbGVldCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9mbGVldC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2ZsZWV0LmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgRmxlZXRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkluaXQge1xuICAgICAgICBwcml2YXRlIGZsZWV0OiBBaXJjcmFmdFtdO1xuICAgICAgICBwcml2YXRlIHNvcnRPcmRlcjogc3RyaW5nID0gJ2FscGhhYmV0aWMnO1xuICAgICAgICBwcml2YXRlIGFjU3RhdHVzRGV0YWlsczogYW55ID0ge307XG4gICAgICAgIHByaXZhdGUgYWNTdGF0dXM6IGFueSA9IHt9O1xuXHRwcml2YXRlIHJlYWR5VG9TaG93ID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3RydWN0b3IocHJpdmF0ZSBfY2hhbmdlRGV0ZWN0aW9uUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgcGFnZTogUGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgcm91dGVyRXh0ZW5zaW9uczogUm91dGVyRXh0ZW5zaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgcGVybWlzc2lvbnNTZXJ2aWNlOiBQZXJtaXNzaW9uc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcml2YXRlIGFwcENvbXBvbmVudDogQXBwQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpdmF0ZSBmbGVldFNlcnZpY2U6IEZsZWV0U2VydmljZSkgeyB9XG5cbiAgICAgICAgQFZpZXdDaGlsZChSYWRTaWRlRHJhd2VyQ29tcG9uZW50KSBwdWJsaWMgZHJhd2VyQ29tcG9uZW50OiBSYWRTaWRlRHJhd2VyQ29tcG9uZW50O1xuICAgICAgICBwcml2YXRlIGRyYXdlcjogUmFkU2lkZURyYXdlcjtcblxuICAgICAgICBuZ09uSW5pdCgpIHtcblx0XHR0aGlzLnVwZGF0ZSgpO1xuXHRcdHRoaXMucGFnZS5vbignbmF2aWdhdGluZ1RvJywgKGRhdGEpID0+IHtcblx0XHRcdHRoaXMudXBkYXRlKCk7XG5cdFx0XHR0aGlzLnJlYWR5VG9TaG93ID0gdHJ1ZTtcblx0XHR9KTtcbiAgICAgICAgfVxuXG5cdHVwZGF0ZSgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsZWV0ID0gdGhpcy5mbGVldFNlcnZpY2UuZ2V0RmxlZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVNvcnRPcmRlcigpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mbGVldC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFjID0gdGhpcy5mbGVldFtpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWNTdGF0dXNEZXRhaWxzW2FjLnJlZ29dID0gdGhpcy5mbGVldFNlcnZpY2UuZ2V0QWlyY3JhZnRTdGF0dXNJdGVtcyhhYyk7IFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY1N0YXR1c1thYy5yZWdvXSA9IHRoaXMuZmxlZXRTZXJ2aWNlLmdldFN0YXR1cyhhYy5yZWdvKTtcbiAgICAgICAgICAgICAgICB9XG5cdH1cblxuICAgICAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3ZXIgPSB0aGlzLmRyYXdlckNvbXBvbmVudC5zaWRlRHJhd2VyO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZURldGVjdGlvblJlZi5kZXRlY3RDaGFuZ2VzKCk7XG5cdFx0Ly8gYSBsaXR0bGUgZGVsYXkgc28gdGhlIHNwaW5uZXIgaGFzIHRpbWUgdG8gc2hvdyB1cFxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0dGhpcy5yZWFkeVRvU2hvdyA9IHRydWU7XG5cdCAgICBcdH0sIDEwMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgaXNBZG1pbkFjY2VzcygpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wZXJtaXNzaW9uc1NlcnZpY2UuaXNBZG1pbkFjY2VzcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FuKGFjdGlvbjogc3RyaW5nKSA6IGJvb2xlYW4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBlcm1pc3Npb25zU2VydmljZS5jYW4oYWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNoYW5nZVNvcnRPcmRlcigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zb3J0T3JkZXIgPT09ICd0eXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGVldC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnR5cGUgPCBiLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS50eXBlID4gYi50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5yZWdvIDwgYi5yZWdvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEucmVnbyA+IGIucmVnbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc29ydE9yZGVyID09PSAnYWxwaGFiZXRpYycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxlZXQuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5yZWdvIDwgYi5yZWdvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEucmVnbyA+IGIucmVnbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBnZXREYXlzTGVmdChhYzogQWlyY3JhZnQpOiBudW1iZXIge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsZWV0U2VydmljZS5nZXREYXlzTGVmdChhYyk7XG4gICAgICAgIH1cblxuICAgICAgICBnZXRIcnNMZWZ0KGFjOiBBaXJjcmFmdCk6IG51bWJlciB7XG4gICAgICAgICAgICAgICAgbGV0IGhycyA9IGFjLmhyc0F0TWFpbnQgLSB0aGlzLmdldFR0aXMoYWMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGhycyoxMCkvIDEwXG4gICAgICAgIH1cblxuICAgICAgICBnZXRUdGlzKGFjOiBBaXJjcmFmdCk6IG51bWJlciB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjLmNsb2NrVGltZSArIGFjLmNsb2NrT2Zmc2V0O1xuICAgICAgICB9XG5cbiAgICAgICAgYWRkQWlyY3JhZnQoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIm5ld0FpcmNyYWZ0XCJdLCB7IGNsZWFySGlzdG9yeTogdHJ1ZSB9KTtcbiAgICAgICAgfVxuXG5cdGdvVG9TdW1tYXJ5KCkge1xuXHRcdHRoaXMucmVhZHlUb1Nob3cgPSBmYWxzZTtcblx0XHR0aGlzLnJvdXRlckV4dGVuc2lvbnMubmF2aWdhdGUoW1wic3VtbWFyeVwiXSwgeyBjbGVhckhpc3Rvcnk6IGZhbHNlIH0pO1xuXHR9XG5cbiAgICAgICAgcHVibGljIGFkZFVzZXIoKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9ncy5sb2dpbih7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJBZGQgTmV3IFVzZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rQnV0dG9uVGV4dDogXCJBZGRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiQ2FuY2VsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLnVzZXJFeGlzdHMoci51c2VyTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwidXNlcjogXCIgKyByLnVzZXJOYW1lICsgXCIgYWxyZWFkeSBleGlzdHNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWN0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlVzZXIgQ2F0ZWdvcnlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiU2VsZWN0IFVzZXIgdHlwZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFtcIkFkbWluXCIsIFwiTWFpbnRhaW5lclwiLCBcIlBpbG90XCIsIFwiUmVhZCBPbmx5XCJdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbigoYykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT09IFwiUmVhZCBPbmx5XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICdkZWZhdWx0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gXCJQaWxvdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAncGlsb3QnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09PSBcIk1haW50YWluZXJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gJ21haW50YWluZXInO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09PSBcIkFkbWluXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9ICdhZG1pbic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zU2VydmljZS5hZGROZXdVc2VyKHIudXNlck5hbWUsIHIucGFzc3dvcmQsIGMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcInVzZXJBZG1pblwiLCByLnVzZXJOYW1lXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHJlbW92ZVVzZXIoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcInVzZXJBZG1pblwiXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgdXNlclNldHRpbmdzKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucm91dGVyRXh0ZW5zaW9ucy5uYXZpZ2F0ZShbXCJ1c2VyQWRtaW5cIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIGxvZ091dCgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zU2VydmljZS5zZXRVc2VyKCdkZWZhdWx0Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi4vdXNlclwiXSwgeyBjbGVhckhpc3Rvcnk6IGZhbHNlIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHRvZ2dsZSgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdlci50b2dnbGVEcmF3ZXJTdGF0ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHRvZ2dsZU9yZGVyKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNvcnRPcmRlciA9PT0gJ3R5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnRPcmRlciA9ICdhbHBoYWJldGljJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc29ydE9yZGVyID09PSAnYWxwaGFiZXRpYycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc29ydE9yZGVyID0gJ3R5cGUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVNvcnRPcmRlcigpO1xuICAgICAgICB9XG5cbn1cbiJdfQ==