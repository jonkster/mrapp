"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_couchbase_1 = require("nativescript-couchbase");
var aircraft_service_1 = require("../aircraft-details/aircraft.service");
var FleetService = /** @class */ (function () {
    function FleetService(aircraftService) {
        this.aircraftService = aircraftService;
        this.reverse = false;
        this.database = new nativescript_couchbase_1.Couchbase("aircraft-database");
        var push = this.database.createPushReplication("http://mcap.australiaeast.cloudapp.azure.com:4984/mcdata");
        //push.setBasicAuthenticator("curtis", "ce55na6789");
        var pull = this.database.createPullReplication("http://mcap.australiaeast.cloudapp.azure.com:4984/mcdata");
        //pull.setBasicAuthenticator("curtis", "ce55na6789");
        push.setContinuous(true);
        pull.setContinuous(true);
        push.start();
        pull.start();
        this.database.createView("aircraft", "1", function (document, emitter) {
            if (document.rego) {
                emitter.emit(document._id, document);
            }
        });
    }
    FleetService.prototype.makeNewAircraft = function (aircraft) {
        var documentId = this.database.createDocument({
            "rego": aircraft.rego,
            "ttis": aircraft.ttis,
            "type": aircraft.type,
            "hrsAtMaint": aircraft.hrsAtMaint,
            "engineHrsAtMaint": aircraft.engineHrsAtMaint,
            "propHrsAtMaint": aircraft.propHrsAtMaint,
            "clockTime": aircraft.clockTime,
            "clockOffset": aircraft.clockOffset,
            "maintenance": aircraft.maintenance
        });
    };
    FleetService.prototype.getFleet = function () {
        this.query();
        return this.aircraft;
    };
    FleetService.prototype.getAircraft = function (id) {
        return this.aircraft.filter(function (aircraft) { return aircraft._id === id; })[0];
    };
    FleetService.prototype.deleteAircraft = function (id) {
        this.database.deleteDocument(id);
        this.aircraft = this.database.executeQuery("aircraft");
    };
    FleetService.prototype.getDaysLeft = function (ac) {
        return this.aircraftService.getDaysLeft(ac);
    };
    FleetService.prototype.query = function () {
        this.aircraft = this.database.executeQuery("aircraft");
        this.hourList = this.sortByHours(this.aircraft);
    };
    FleetService.prototype.regoExists = function (rego) {
        var r = this.aircraft.filter(function (aircraft) { return aircraft.rego === rego; })[0];
        return (r !== undefined);
    };
    FleetService.prototype.compareByDate = function (a, b) {
        var aLeft = a.daysLeft;
        var bLeft = b.daysLeft;
        if (aLeft === undefined) {
            aLeft = 10000;
        }
        if (bLeft === undefined) {
            bLeft = 10000;
        }
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        if (a.type === 'hours') {
            return this.compareByHours(a, b);
        }
        return 0;
    };
    FleetService.prototype.compareByEstimatedDate = function (a, b) {
        var aLeft = a.daysLeft;
        var bLeft = b.daysLeft;
        if (aLeft === undefined) {
            aLeft = 10000;
        }
        if (bLeft === undefined) {
            bLeft = 10000;
        }
        if (a.type === 'hours') {
            aLeft = a.hoursLeft / 2;
        }
        if (b.type === 'hours') {
            bLeft = b.hoursLeft / 2;
        }
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        return 0;
    };
    FleetService.prototype.compareByHours = function (a, b) {
        var aLeft = a.hoursLeft;
        var bLeft = b.hoursLeft;
        if (aLeft === undefined) {
            aLeft = 10000;
        }
        if (bLeft === undefined) {
            bLeft = 10000;
        }
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        if (a.type === 'date') {
            return this.compareByDate(a, b);
        }
        return 0;
    };
    FleetService.prototype.getDate = function () {
        return this.dateList;
    };
    FleetService.prototype.getEstimatedDate = function () {
        return this.estimatedDateList;
    };
    FleetService.prototype.getHours = function () {
        return this.hourList;
    };
    FleetService.prototype.reverseSort = function () {
        this.reverse = !this.reverse;
    };
    FleetService.prototype.sortByHours = function (aircraft) {
        var _this = this;
        this.hourList = [];
        this.dateList = [];
        for (var i = 0; i < aircraft.length; i++) {
            var ac = aircraft[i];
            this.hourList.push({
                '_id': ac._id,
                'rego': ac.rego,
                'item': '100 hourly',
                'hoursLeft': this.aircraftService.getHrsLeft(ac),
                'daysLeft': this.aircraftService.getDaysLeft(ac)
            });
            for (var j = 0; j < ac.maintenance.length; j++) {
                var item = ac.maintenance[j];
                if (item.maintenance !== "") {
                    var hleft = undefined;
                    var dleft = undefined;
                    if (item.type == 'hours') {
                        hleft = item.dueHrs - ac.ttis;
                    }
                    else {
                        dleft = this.aircraftService.getMaintDaysLeft(item.dueDateTuple);
                    }
                    this.hourList.push({
                        '_id': ac._id,
                        'rego': ac.rego,
                        'type': item.type,
                        'item': item.maintenance,
                        'hoursLeft': hleft,
                        'daysLeft': dleft
                    });
                }
            }
        }
        this.hourList = this.hourList.sort(function (a, b) { return _this.compareByHours(a, b); });
        this.dateList = Object.assign([], this.hourList);
        this.dateList = this.dateList.sort(function (a, b) { return _this.compareByDate(a, b); });
        this.estimatedDateList = Object.assign([], this.hourList);
        this.estimatedDateList = this.estimatedDateList.sort(function (a, b) { return _this.compareByEstimatedDate(a, b); });
        if (this.reverse) {
            this.hourList = this.hourList.reverse();
        }
        return this.hourList;
    };
    FleetService.prototype.updateAircraft = function (ac) {
        this.database.updateDocument(ac._id, ac);
        this.aircraft = this.database.executeQuery("aircraft");
    };
    FleetService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [aircraft_service_1.AircraftService])
    ], FleetService);
    return FleetService;
}());
exports.FleetService = FleetService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxlZXQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZsZWV0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsaUVBQWlEO0FBQ2pELHlFQUF1RTtBQUt2RTtJQVFFLHNCQUFvQixlQUFnQztRQUFoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFMMUMsWUFBTyxHQUFZLEtBQUssQ0FBQztRQU03QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksa0NBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQzNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsMERBQTBELENBQUMsQ0FBQztRQUMzRyxxREFBcUQ7UUFFckQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQywwREFBMEQsQ0FBQyxDQUFDO1FBQzNHLHFEQUFxRDtRQUVyRCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxVQUFTLFFBQVEsRUFBRSxPQUFPO1lBQ2hFLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUN6QyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU0sc0NBQWUsR0FBdEIsVUFBdUIsUUFBa0I7UUFDakMsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENB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QyxDQUFDO1FBRWxHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1gsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2hELENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN6QixDQUFDO0lBRU0scUNBQWMsR0FBckIsVUFBc0IsRUFBWTtRQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxRQUFRLEdBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQXBOUSxZQUFZO1FBRHhCLGlCQUFVLEVBQUU7eUNBUzBCLGtDQUFlO09BUnpDLFlBQVksQ0FzTnhCO0lBQUQsbUJBQUM7Q0FBQSxBQXRORCxJQXNOQztBQXROWSxvQ0FBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q291Y2hiYXNlfSBmcm9tICduYXRpdmVzY3JpcHQtY291Y2hiYXNlJztcbmltcG9ydCB7IEFpcmNyYWZ0U2VydmljZSB9IGZyb20gXCIuLi9haXJjcmFmdC1kZXRhaWxzL2FpcmNyYWZ0LnNlcnZpY2VcIjtcblxuaW1wb3J0IHsgQWlyY3JhZnQsIE1haW50ZW5hbmNlSXRlbSB9IGZyb20gXCIuL2FpcmNyYWZ0XCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGbGVldFNlcnZpY2Uge1xuICAgIHB1YmxpYyBkYXRhYmFzZTogYW55O1xuICAgIHByaXZhdGUgYWlyY3JhZnQ6IEFpcmNyYWZ0W107XG4gICAgcHJpdmF0ZSByZXZlcnNlOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBkYXRlTGlzdDogYW55W107XG4gICAgcHJpdmF0ZSBob3VyTGlzdDogYW55W107XG4gICAgcHJpdmF0ZSBlc3RpbWF0ZWREYXRlTGlzdDogYW55W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhaXJjcmFmdFNlcnZpY2U6IEFpcmNyYWZ0U2VydmljZSkgeyBcbiAgICAgICAgdGhpcy5kYXRhYmFzZSA9IG5ldyBDb3VjaGJhc2UoXCJhaXJjcmFmdC1kYXRhYmFzZVwiKTtcbmxldCBwdXNoID0gdGhpcy5kYXRhYmFzZS5jcmVhdGVQdXNoUmVwbGljYXRpb24oXCJodHRwOi8vbWNhcC5hdXN0cmFsaWFlYXN0LmNsb3VkYXBwLmF6dXJlLmNvbTo0OTg0L21jZGF0YVwiKTtcbi8vcHVzaC5zZXRCYXNpY0F1dGhlbnRpY2F0b3IoXCJjdXJ0aXNcIiwgXCJjZTU1bmE2Nzg5XCIpO1xuXG5sZXQgcHVsbCA9IHRoaXMuZGF0YWJhc2UuY3JlYXRlUHVsbFJlcGxpY2F0aW9uKFwiaHR0cDovL21jYXAuYXVzdHJhbGlhZWFzdC5jbG91ZGFwcC5henVyZS5jb206NDk4NC9tY2RhdGFcIik7XG4vL3B1bGwuc2V0QmFzaWNBdXRoZW50aWNhdG9yKFwiY3VydGlzXCIsIFwiY2U1NW5hNjc4OVwiKTtcblxucHVzaC5zZXRDb250aW51b3VzKHRydWUpO1xucHVsbC5zZXRDb250aW51b3VzKHRydWUpO1xucHVzaC5zdGFydCgpO1xucHVsbC5zdGFydCgpO1xuICAgICAgICB0aGlzLmRhdGFiYXNlLmNyZWF0ZVZpZXcoXCJhaXJjcmFmdFwiLCBcIjFcIiwgZnVuY3Rpb24oZG9jdW1lbnQsIGVtaXR0ZXIpIHtcbiAgICAgICAgICAgIGlmKGRvY3VtZW50LnJlZ28pIHtcbiAgICAgICAgICAgICAgICBlbWl0dGVyLmVtaXQoZG9jdW1lbnQuX2lkLCBkb2N1bWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBtYWtlTmV3QWlyY3JhZnQoYWlyY3JhZnQ6IEFpcmNyYWZ0KSB7XG4gICAgICAgICAgICBsZXQgZG9jdW1lbnRJZCA9IHRoaXMuZGF0YWJhc2UuY3JlYXRlRG9jdW1lbnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicmVnb1wiOiBhaXJjcmFmdC5yZWdvLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHRpc1wiOiBhaXJjcmFmdC50dGlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBhaXJjcmFmdC50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaHJzQXRNYWludFwiOiBhaXJjcmFmdC5ocnNBdE1haW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZW5naW5lSHJzQXRNYWludFwiOiBhaXJjcmFmdC5lbmdpbmVIcnNBdE1haW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJvcEhyc0F0TWFpbnRcIjogYWlyY3JhZnQucHJvcEhyc0F0TWFpbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjbG9ja1RpbWVcIjogYWlyY3JhZnQuY2xvY2tUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xvY2tPZmZzZXRcIjogYWlyY3JhZnQuY2xvY2tPZmZzZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtYWludGVuYW5jZVwiOiBhaXJjcmFmdC5tYWludGVuYW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldEZsZWV0KCk6IEFpcmNyYWZ0W10ge1xuICAgICAgICB0aGlzLnF1ZXJ5KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmFpcmNyYWZ0O1xuICAgIH1cblxuICAgIGdldEFpcmNyYWZ0KGlkOiBzdHJpbmcpOiBBaXJjcmFmdCB7XG4gICAgICAgIHJldHVybiB0aGlzLmFpcmNyYWZ0LmZpbHRlciggYWlyY3JhZnQgPT4gYWlyY3JhZnQuX2lkID09PSBpZClbMF07XG4gICAgfVxuXG4gICAgcHVibGljIGRlbGV0ZUFpcmNyYWZ0KGlkOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UuZGVsZXRlRG9jdW1lbnQoaWQpO1xuICAgICAgICAgICAgdGhpcy5haXJjcmFmdCA9ICB0aGlzLmRhdGFiYXNlLmV4ZWN1dGVRdWVyeShcImFpcmNyYWZ0XCIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXREYXlzTGVmdChhYzogQWlyY3JhZnQpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5haXJjcmFmdFNlcnZpY2UuZ2V0RGF5c0xlZnQoYWMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBxdWVyeSgpIHtcbiAgICAgICAgICAgIHRoaXMuYWlyY3JhZnQgPSAgdGhpcy5kYXRhYmFzZS5leGVjdXRlUXVlcnkoXCJhaXJjcmFmdFwiKTtcbiAgICAgICAgICAgIHRoaXMuaG91ckxpc3QgPSB0aGlzLnNvcnRCeUhvdXJzKHRoaXMuYWlyY3JhZnQpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWdvRXhpc3RzKHJlZ286IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgciA9IHRoaXMuYWlyY3JhZnQuZmlsdGVyKGFpcmNyYWZ0ID0+IGFpcmNyYWZ0LnJlZ28gPT09IHJlZ28pWzBdO1xuICAgICAgICByZXR1cm4gKHIgIT09IHVuZGVmaW5lZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21wYXJlQnlEYXRlKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgICAgICBsZXQgYUxlZnQ6bnVtYmVyID0gYS5kYXlzTGVmdDtcbiAgICAgICAgICAgIGxldCBiTGVmdDpudW1iZXIgPSBiLmRheXNMZWZ0XG5cbiAgICAgICAgICAgIGlmIChhTGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYUxlZnQgPSAxMDAwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChiTGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYkxlZnQgPSAxMDAwMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFMZWZ0IDwgYkxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFMZWZ0ID4gYkxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYS50eXBlID09PSAnaG91cnMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZUJ5SG91cnMoYSwgYik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbXBhcmVCeUVzdGltYXRlZERhdGUoYTogYW55LCBiOiBhbnkpIHtcbiAgICAgICAgICAgIGxldCBhTGVmdDpudW1iZXIgPSBhLmRheXNMZWZ0O1xuICAgICAgICAgICAgbGV0IGJMZWZ0Om51bWJlciA9IGIuZGF5c0xlZnRcblxuICAgICAgICAgICAgaWYgKGFMZWZ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBhTGVmdCA9IDEwMDAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJMZWZ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBiTGVmdCA9IDEwMDAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYS50eXBlID09PSAnaG91cnMnKSB7XG4gICAgICAgICAgICAgICAgICAgIGFMZWZ0ID0gYS5ob3Vyc0xlZnQgLyAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGIudHlwZSA9PT0gJ2hvdXJzJykge1xuICAgICAgICAgICAgICAgICAgICBiTGVmdCA9IGIuaG91cnNMZWZ0IC8gMjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFMZWZ0IDwgYkxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFMZWZ0ID4gYkxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbXBhcmVCeUhvdXJzKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgICAgICBsZXQgYUxlZnQ6bnVtYmVyID0gYS5ob3Vyc0xlZnQ7XG4gICAgICAgICAgICBsZXQgYkxlZnQ6bnVtYmVyID0gYi5ob3Vyc0xlZnRcblxuICAgICAgICAgICAgaWYgKGFMZWZ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBhTGVmdCA9IDEwMDAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJMZWZ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBiTGVmdCA9IDEwMDAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYUxlZnQgPCBiTGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYUxlZnQgPiBiTGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhLnR5cGUgPT09ICdkYXRlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVCeURhdGUoYSwgYik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEVzdGltYXRlZERhdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVzdGltYXRlZERhdGVMaXN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRIb3VycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaG91ckxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIHJldmVyc2VTb3J0KCkge1xuICAgICAgICB0aGlzLnJldmVyc2UgPSAhIHRoaXMucmV2ZXJzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc29ydEJ5SG91cnMoYWlyY3JhZnQ6IEFpcmNyYWZ0W10pIHtcbiAgICAgICAgdGhpcy5ob3VyTGlzdCA9IFtdOyBcbiAgICAgICAgdGhpcy5kYXRlTGlzdCA9IFtdOyBcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhaXJjcmFmdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCBhYyA9IGFpcmNyYWZ0W2ldO1xuICAgICAgICAgICAgICAgIHRoaXMuaG91ckxpc3QucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ19pZCc6IGFjLl9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZ28nOiBhYy5yZWdvLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXRlbSc6ICcxMDAgaG91cmx5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hvdXJzTGVmdCc6IHRoaXMuYWlyY3JhZnRTZXJ2aWNlLmdldEhyc0xlZnQoYWMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF5c0xlZnQnOiB0aGlzLmFpcmNyYWZ0U2VydmljZS5nZXREYXlzTGVmdChhYylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYWMubWFpbnRlbmFuY2UubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtOiBNYWludGVuYW5jZUl0ZW0gPSBhYy5tYWludGVuYW5jZVtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm1haW50ZW5hbmNlICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBobGVmdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRsZWZ0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlID09ICdob3VycycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBobGVmdCA9IGl0ZW0uZHVlSHJzIC0gYWMudHRpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbGVmdCA9IHRoaXMuYWlyY3JhZnRTZXJ2aWNlLmdldE1haW50RGF5c0xlZnQoaXRlbS5kdWVEYXRlVHVwbGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3VyTGlzdC5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnX2lkJzogYWMuX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWdvJzogYWMucmVnbyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZSc6IGl0ZW0udHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXRlbSc6IGl0ZW0ubWFpbnRlbmFuY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hvdXJzTGVmdCc6IGhsZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXlzTGVmdCc6IGRsZWZ0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhvdXJMaXN0ID0gdGhpcy5ob3VyTGlzdC5zb3J0KChhLCBiKSA9PiB0aGlzLmNvbXBhcmVCeUhvdXJzKGEsIGIpKTtcblxuICAgICAgICB0aGlzLmRhdGVMaXN0ID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5ob3VyTGlzdCk7XG4gICAgICAgIHRoaXMuZGF0ZUxpc3QgPSB0aGlzLmRhdGVMaXN0LnNvcnQoKGEsIGIpID0+IHRoaXMuY29tcGFyZUJ5RGF0ZShhLCBiKSk7XG5cbiAgICAgICAgdGhpcy5lc3RpbWF0ZWREYXRlTGlzdCA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMuaG91ckxpc3QpO1xuICAgICAgICB0aGlzLmVzdGltYXRlZERhdGVMaXN0ID0gdGhpcy5lc3RpbWF0ZWREYXRlTGlzdC5zb3J0KChhLCBiKSA9PiB0aGlzLmNvbXBhcmVCeUVzdGltYXRlZERhdGUoYSwgYikpO1xuXG4gICAgICAgIGlmICh0aGlzLnJldmVyc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhvdXJMaXN0ID0gdGhpcy5ob3VyTGlzdC5yZXZlcnNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaG91ckxpc3Q7XG4gICAgfSAgICBcblxuICAgIHB1YmxpYyB1cGRhdGVBaXJjcmFmdChhYzogQWlyY3JhZnQpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UudXBkYXRlRG9jdW1lbnQoYWMuX2lkLCBhYyk7XG4gICAgICAgICAgICB0aGlzLmFpcmNyYWZ0ID0gIHRoaXMuZGF0YWJhc2UuZXhlY3V0ZVF1ZXJ5KFwiYWlyY3JhZnRcIik7XG4gICAgfVxuXG59XG4iXX0=