"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_couchbase_1 = require("nativescript-couchbase");
var aircraft_service_1 = require("../aircraft-details/aircraft.service");
var FleetService = /** @class */ (function () {
    function FleetService(aircraftService) {
        this.aircraftService = aircraftService;
        this.reverse = false;
        this.database = new nativescript_couchbase_1.Couchbase("aircraft-database");
        var push = this.database.createPushReplication("http://mcap.australiaeast.cloudapp.azure.com:4984/mcdata");
        var pull = this.database.createPullReplication("http://mcap.australiaeast.cloudapp.azure.com:4984/mcdata");
        push.setContinuous(true);
        pull.setContinuous(true);
        push.start();
        pull.start();
        this.database.createView("aircraft", "1", function (document, emitter) {
            if (document.rego) {
                emitter.emit(document._id, document);
            }
        });
    }
    FleetService.prototype.makeNewAircraft = function (aircraft) {
        var documentId = this.database.createDocument({
            "rego": aircraft.rego,
            "ttis": aircraft.ttis,
            "type": aircraft.type,
            "hrsAtMaint": aircraft.hrsAtMaint,
            "engineHrsAtMaint": aircraft.engineHrsAtMaint,
            "propHrsAtMaint": aircraft.propHrsAtMaint,
            "clockTime": aircraft.clockTime,
            "clockOffset": aircraft.clockOffset,
            "maintenance": aircraft.maintenance
        });
    };
    FleetService.prototype.getFleet = function () {
        this.query();
        return this.aircraft;
    };
    FleetService.prototype.getAircraft = function (id) {
        return this.aircraft.filter(function (aircraft) { return aircraft._id === id; })[0];
    };
    FleetService.prototype.deleteAircraft = function (id) {
        this.database.deleteDocument(id);
        this.aircraft = this.database.executeQuery("aircraft");
    };
    FleetService.prototype.getDaysLeft = function (ac) {
        return this.aircraftService.getDaysLeft(ac);
    };
    FleetService.prototype.query = function () {
        this.aircraft = this.database.executeQuery("aircraft");
        this.hourList = this.sortByHours(this.aircraft);
    };
    FleetService.prototype.regoExists = function (rego) {
        var r = this.aircraft.filter(function (aircraft) { return aircraft.rego === rego; })[0];
        return (r !== undefined);
    };
    FleetService.prototype.compareByDate = function (a, b) {
        var aLeft = a.daysLeft;
        var bLeft = b.daysLeft;
        if (aLeft === undefined) {
            aLeft = 10000;
        }
        if (bLeft === undefined) {
            bLeft = 10000;
        }
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        if (a.type === 'hours') {
            return this.compareByHours(a, b);
        }
        return 0;
    };
    FleetService.prototype.compareByEstimatedDate = function (a, b) {
        var aLeft = a.daysLeft;
        var bLeft = b.daysLeft;
        if (aLeft === undefined) {
            aLeft = 10000;
        }
        if (bLeft === undefined) {
            bLeft = 10000;
        }
        if (a.type === 'hours') {
            aLeft = a.hoursLeft / 2;
        }
        if (b.type === 'hours') {
            bLeft = b.hoursLeft / 2;
        }
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        return 0;
    };
    FleetService.prototype.compareByHours = function (a, b) {
        var aLeft = a.hoursLeft;
        var bLeft = b.hoursLeft;
        if (aLeft === undefined) {
            aLeft = 10000;
        }
        if (bLeft === undefined) {
            bLeft = 10000;
        }
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        if (a.type === 'date') {
            return this.compareByDate(a, b);
        }
        return 0;
    };
    FleetService.prototype.compareByType = function (a, b) {
        var aLeft = a.type;
        var bLeft = b.type;
        if (aLeft < bLeft) {
            return -1;
        }
        if (aLeft > bLeft) {
            return 1;
        }
        if (a.rego < b.rego) {
            return -1;
        }
        if (a.rego > b.rego) {
            return 1;
        }
        return 0;
    };
    FleetService.prototype.getDate = function () {
        return this.dateList;
    };
    FleetService.prototype.getEstimatedDate = function () {
        return this.estimatedDateList;
    };
    FleetService.prototype.getHours = function () {
        return this.hourList;
    };
    FleetService.prototype.getType = function () {
        return this.typeList;
    };
    FleetService.prototype.reverseSort = function () {
        this.reverse = !this.reverse;
    };
    FleetService.prototype.sortByHours = function (aircraft) {
        var _this = this;
        this.hourList = [];
        this.dateList = [];
        for (var i = 0; i < aircraft.length; i++) {
            var ac = aircraft[i];
            this.hourList.push({
                '_id': ac._id,
                'rego': ac.rego,
                'item': '100 hourly',
                'hoursLeft': this.aircraftService.getHrsLeft(ac),
                'daysLeft': this.aircraftService.getDaysLeft(ac)
            });
            for (var j = 0; j < ac.maintenance.length; j++) {
                var item = ac.maintenance[j];
                if (item.maintenance !== "") {
                    var hleft = undefined;
                    var dleft = undefined;
                    if (item.type == 'hours') {
                        hleft = item.dueHrs - ac.ttis;
                    }
                    else {
                        dleft = this.aircraftService.getMaintDaysLeft(item.dueDateTuple);
                    }
                    this.hourList.push({
                        '_id': ac._id,
                        'rego': ac.rego,
                        'type': item.type,
                        'item': item.maintenance,
                        'hoursLeft': hleft,
                        'daysLeft': dleft
                    });
                }
            }
        }
        this.hourList = this.hourList.sort(function (a, b) { return _this.compareByHours(a, b); });
        this.dateList = Object.assign([], this.hourList);
        this.dateList = this.dateList.sort(function (a, b) { return _this.compareByDate(a, b); });
        this.estimatedDateList = Object.assign([], this.hourList);
        this.estimatedDateList = this.estimatedDateList.sort(function (a, b) { return _this.compareByEstimatedDate(a, b); });
        this.typeList = Object.assign([], this.hourList);
        this.typeList = this.typeList.sort(function (a, b) { return _this.compareByType(a, b); });
        if (this.reverse) {
            this.hourList = this.hourList.reverse();
        }
        return this.hourList;
    };
    FleetService.prototype.updateAircraft = function (ac) {
        this.database.updateDocument(ac._id, ac);
        this.aircraft = this.database.executeQuery("aircraft");
    };
    FleetService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [aircraft_service_1.AircraftService])
    ], FleetService);
    return FleetService;
}());
exports.FleetService = FleetService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxlZXQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZsZWV0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsaUVBQWlEO0FBQ2pELHlFQUF1RTtBQUt2RTtJQVNFLHNCQUFvQixlQUFnQztRQUFoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFOMUMsWUFBTyxHQUFZLEtBQUssQ0FBQztRQU83QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksa0NBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ25ELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsMERBQTBELENBQUMsQ0FBQztRQUUzRyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLHFCQUFxQixDQUFDLDBEQUEwRCxDQUFDLENBQUM7UUFFM0csSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUViLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsVUFBUyxRQUFRLEVBQUUsT0FBTztZQUNoRSxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDZixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDekMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLHNDQUFlLEdBQXRCLFVBQXVCLFFBQWtCO1FBQ2pDLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDO1lBQzlCLE1BQU0sRUFBRSxRQUFRLENB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QUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2hELENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN6QixDQUFDO0lBRU0scUNBQWMsR0FBckIsVUFBc0IsRUFBWTtRQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxRQUFRLEdBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQTlPUSxZQUFZO1FBRHhCLGlCQUFVLEVBQUU7eUNBVTBCLGtDQUFlO09BVHpDLFlBQVksQ0FnUHhCO0lBQUQsbUJBQUM7Q0FBQSxBQWhQRCxJQWdQQztBQWhQWSxvQ0FBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q291Y2hiYXNlfSBmcm9tICduYXRpdmVzY3JpcHQtY291Y2hiYXNlJztcbmltcG9ydCB7IEFpcmNyYWZ0U2VydmljZSB9IGZyb20gXCIuLi9haXJjcmFmdC1kZXRhaWxzL2FpcmNyYWZ0LnNlcnZpY2VcIjtcblxuaW1wb3J0IHsgQWlyY3JhZnQsIE1haW50ZW5hbmNlSXRlbSB9IGZyb20gXCIuL2FpcmNyYWZ0XCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGbGVldFNlcnZpY2Uge1xuICAgIHB1YmxpYyBkYXRhYmFzZTogYW55O1xuICAgIHByaXZhdGUgYWlyY3JhZnQ6IEFpcmNyYWZ0W107XG4gICAgcHJpdmF0ZSByZXZlcnNlOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBkYXRlTGlzdDogYW55W107XG4gICAgcHJpdmF0ZSBob3VyTGlzdDogYW55W107XG4gICAgcHJpdmF0ZSB0eXBlTGlzdDogYW55W107XG4gICAgcHJpdmF0ZSBlc3RpbWF0ZWREYXRlTGlzdDogYW55W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhaXJjcmFmdFNlcnZpY2U6IEFpcmNyYWZ0U2VydmljZSkgeyBcbiAgICAgICAgdGhpcy5kYXRhYmFzZSA9IG5ldyBDb3VjaGJhc2UoXCJhaXJjcmFmdC1kYXRhYmFzZVwiKTtcbiAgICAgICAgbGV0IHB1c2ggPSB0aGlzLmRhdGFiYXNlLmNyZWF0ZVB1c2hSZXBsaWNhdGlvbihcImh0dHA6Ly9tY2FwLmF1c3RyYWxpYWVhc3QuY2xvdWRhcHAuYXp1cmUuY29tOjQ5ODQvbWNkYXRhXCIpO1xuXG4gICAgICAgIGxldCBwdWxsID0gdGhpcy5kYXRhYmFzZS5jcmVhdGVQdWxsUmVwbGljYXRpb24oXCJodHRwOi8vbWNhcC5hdXN0cmFsaWFlYXN0LmNsb3VkYXBwLmF6dXJlLmNvbTo0OTg0L21jZGF0YVwiKTtcblxuICAgICAgICBwdXNoLnNldENvbnRpbnVvdXModHJ1ZSk7XG4gICAgICAgIHB1bGwuc2V0Q29udGludW91cyh0cnVlKTtcbiAgICAgICAgcHVzaC5zdGFydCgpO1xuICAgICAgICBwdWxsLnN0YXJ0KCk7XG5cbiAgICAgICAgdGhpcy5kYXRhYmFzZS5jcmVhdGVWaWV3KFwiYWlyY3JhZnRcIiwgXCIxXCIsIGZ1bmN0aW9uKGRvY3VtZW50LCBlbWl0dGVyKSB7XG4gICAgICAgICAgICBpZihkb2N1bWVudC5yZWdvKSB7XG4gICAgICAgICAgICAgICAgZW1pdHRlci5lbWl0KGRvY3VtZW50Ll9pZCwgZG9jdW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbWFrZU5ld0FpcmNyYWZ0KGFpcmNyYWZ0OiBBaXJjcmFmdCkge1xuICAgICAgICAgICAgbGV0IGRvY3VtZW50SWQgPSB0aGlzLmRhdGFiYXNlLmNyZWF0ZURvY3VtZW50KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlZ29cIjogYWlyY3JhZnQucmVnbyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR0aXNcIjogYWlyY3JhZnQudHRpcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogYWlyY3JhZnQudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhyc0F0TWFpbnRcIjogYWlyY3JhZnQuaHJzQXRNYWludCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVuZ2luZUhyc0F0TWFpbnRcIjogYWlyY3JhZnQuZW5naW5lSHJzQXRNYWludCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb3BIcnNBdE1haW50XCI6IGFpcmNyYWZ0LnByb3BIcnNBdE1haW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xvY2tUaW1lXCI6IGFpcmNyYWZ0LmNsb2NrVGltZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsb2NrT2Zmc2V0XCI6IGFpcmNyYWZ0LmNsb2NrT2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWFpbnRlbmFuY2VcIjogYWlyY3JhZnQubWFpbnRlbmFuY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRGbGVldCgpOiBBaXJjcmFmdFtdIHtcbiAgICAgICAgdGhpcy5xdWVyeSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5haXJjcmFmdDtcbiAgICB9XG5cbiAgICBnZXRBaXJjcmFmdChpZDogc3RyaW5nKTogQWlyY3JhZnQge1xuICAgICAgICByZXR1cm4gdGhpcy5haXJjcmFmdC5maWx0ZXIoIGFpcmNyYWZ0ID0+IGFpcmNyYWZ0Ll9pZCA9PT0gaWQpWzBdO1xuICAgIH1cblxuICAgIHB1YmxpYyBkZWxldGVBaXJjcmFmdChpZDogc3RyaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGFiYXNlLmRlbGV0ZURvY3VtZW50KGlkKTtcbiAgICAgICAgICAgIHRoaXMuYWlyY3JhZnQgPSAgdGhpcy5kYXRhYmFzZS5leGVjdXRlUXVlcnkoXCJhaXJjcmFmdFwiKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RGF5c0xlZnQoYWM6IEFpcmNyYWZ0KTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWlyY3JhZnRTZXJ2aWNlLmdldERheXNMZWZ0KGFjKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcXVlcnkoKSB7XG4gICAgICAgICAgICB0aGlzLmFpcmNyYWZ0ID0gIHRoaXMuZGF0YWJhc2UuZXhlY3V0ZVF1ZXJ5KFwiYWlyY3JhZnRcIik7XG4gICAgICAgICAgICB0aGlzLmhvdXJMaXN0ID0gdGhpcy5zb3J0QnlIb3Vycyh0aGlzLmFpcmNyYWZ0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVnb0V4aXN0cyhyZWdvOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgbGV0IHIgPSB0aGlzLmFpcmNyYWZ0LmZpbHRlcihhaXJjcmFmdCA9PiBhaXJjcmFmdC5yZWdvID09PSByZWdvKVswXTtcbiAgICAgICAgcmV0dXJuIChyICE9PSB1bmRlZmluZWQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29tcGFyZUJ5RGF0ZShhOiBhbnksIGI6IGFueSkge1xuICAgICAgICAgICAgbGV0IGFMZWZ0Om51bWJlciA9IGEuZGF5c0xlZnQ7XG4gICAgICAgICAgICBsZXQgYkxlZnQ6bnVtYmVyID0gYi5kYXlzTGVmdFxuXG4gICAgICAgICAgICBpZiAoYUxlZnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGFMZWZ0ID0gMTAwMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYkxlZnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGJMZWZ0ID0gMTAwMDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhTGVmdCA8IGJMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhTGVmdCA+IGJMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGEudHlwZSA9PT0gJ2hvdXJzJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVCeUhvdXJzKGEsIGIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21wYXJlQnlFc3RpbWF0ZWREYXRlKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgICAgICBsZXQgYUxlZnQ6bnVtYmVyID0gYS5kYXlzTGVmdDtcbiAgICAgICAgICAgIGxldCBiTGVmdDpudW1iZXIgPSBiLmRheXNMZWZ0XG5cbiAgICAgICAgICAgIGlmIChhTGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYUxlZnQgPSAxMDAwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChiTGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYkxlZnQgPSAxMDAwMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGEudHlwZSA9PT0gJ2hvdXJzJykge1xuICAgICAgICAgICAgICAgICAgICBhTGVmdCA9IGEuaG91cnNMZWZ0IC8gMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChiLnR5cGUgPT09ICdob3VycycpIHtcbiAgICAgICAgICAgICAgICAgICAgYkxlZnQgPSBiLmhvdXJzTGVmdCAvIDI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhTGVmdCA8IGJMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhTGVmdCA+IGJMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21wYXJlQnlIb3VycyhhOiBhbnksIGI6IGFueSkge1xuICAgICAgICAgICAgbGV0IGFMZWZ0Om51bWJlciA9IGEuaG91cnNMZWZ0O1xuICAgICAgICAgICAgbGV0IGJMZWZ0Om51bWJlciA9IGIuaG91cnNMZWZ0XG5cbiAgICAgICAgICAgIGlmIChhTGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYUxlZnQgPSAxMDAwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChiTGVmdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYkxlZnQgPSAxMDAwMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFMZWZ0IDwgYkxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFMZWZ0ID4gYkxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYS50eXBlID09PSAnZGF0ZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlQnlEYXRlKGEsIGIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21wYXJlQnlUeXBlKGE6IGFueSwgYjogYW55KSB7XG4gICAgICAgICAgICBsZXQgYUxlZnQ6c3RyaW5nID0gYS50eXBlO1xuICAgICAgICAgICAgbGV0IGJMZWZ0OnN0cmluZyA9IGIudHlwZVxuXG4gICAgICAgICAgICBpZiAoYUxlZnQgPCBiTGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYUxlZnQgPiBiTGVmdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhLnJlZ28gPCBiLnJlZ28pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGEucmVnbyA+IGIucmVnbykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXREYXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRlTGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RXN0aW1hdGVkRGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXN0aW1hdGVkRGF0ZUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEhvdXJzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ob3VyTGlzdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0VHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZUxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIHJldmVyc2VTb3J0KCkge1xuICAgICAgICB0aGlzLnJldmVyc2UgPSAhIHRoaXMucmV2ZXJzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc29ydEJ5SG91cnMoYWlyY3JhZnQ6IEFpcmNyYWZ0W10pIHtcbiAgICAgICAgdGhpcy5ob3VyTGlzdCA9IFtdOyBcbiAgICAgICAgdGhpcy5kYXRlTGlzdCA9IFtdOyBcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhaXJjcmFmdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCBhYyA9IGFpcmNyYWZ0W2ldO1xuICAgICAgICAgICAgICAgIHRoaXMuaG91ckxpc3QucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ19pZCc6IGFjLl9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZ28nOiBhYy5yZWdvLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXRlbSc6ICcxMDAgaG91cmx5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hvdXJzTGVmdCc6IHRoaXMuYWlyY3JhZnRTZXJ2aWNlLmdldEhyc0xlZnQoYWMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF5c0xlZnQnOiB0aGlzLmFpcmNyYWZ0U2VydmljZS5nZXREYXlzTGVmdChhYylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYWMubWFpbnRlbmFuY2UubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtOiBNYWludGVuYW5jZUl0ZW0gPSBhYy5tYWludGVuYW5jZVtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm1haW50ZW5hbmNlICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBobGVmdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRsZWZ0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlID09ICdob3VycycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBobGVmdCA9IGl0ZW0uZHVlSHJzIC0gYWMudHRpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbGVmdCA9IHRoaXMuYWlyY3JhZnRTZXJ2aWNlLmdldE1haW50RGF5c0xlZnQoaXRlbS5kdWVEYXRlVHVwbGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3VyTGlzdC5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnX2lkJzogYWMuX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWdvJzogYWMucmVnbyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZSc6IGl0ZW0udHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXRlbSc6IGl0ZW0ubWFpbnRlbmFuY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hvdXJzTGVmdCc6IGhsZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXlzTGVmdCc6IGRsZWZ0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhvdXJMaXN0ID0gdGhpcy5ob3VyTGlzdC5zb3J0KChhLCBiKSA9PiB0aGlzLmNvbXBhcmVCeUhvdXJzKGEsIGIpKTtcblxuICAgICAgICB0aGlzLmRhdGVMaXN0ID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5ob3VyTGlzdCk7XG4gICAgICAgIHRoaXMuZGF0ZUxpc3QgPSB0aGlzLmRhdGVMaXN0LnNvcnQoKGEsIGIpID0+IHRoaXMuY29tcGFyZUJ5RGF0ZShhLCBiKSk7XG5cbiAgICAgICAgdGhpcy5lc3RpbWF0ZWREYXRlTGlzdCA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMuaG91ckxpc3QpO1xuICAgICAgICB0aGlzLmVzdGltYXRlZERhdGVMaXN0ID0gdGhpcy5lc3RpbWF0ZWREYXRlTGlzdC5zb3J0KChhLCBiKSA9PiB0aGlzLmNvbXBhcmVCeUVzdGltYXRlZERhdGUoYSwgYikpO1xuXG4gICAgICAgIHRoaXMudHlwZUxpc3QgPSBPYmplY3QuYXNzaWduKFtdLCB0aGlzLmhvdXJMaXN0KTtcbiAgICAgICAgdGhpcy50eXBlTGlzdCA9IHRoaXMudHlwZUxpc3Quc29ydCgoYSwgYikgPT4gdGhpcy5jb21wYXJlQnlUeXBlKGEsIGIpKTtcblxuICAgICAgICBpZiAodGhpcy5yZXZlcnNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob3VyTGlzdCA9IHRoaXMuaG91ckxpc3QucmV2ZXJzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmhvdXJMaXN0O1xuICAgIH0gICAgXG5cbiAgICBwdWJsaWMgdXBkYXRlQWlyY3JhZnQoYWM6IEFpcmNyYWZ0KSB7XG4gICAgICAgICAgICB0aGlzLmRhdGFiYXNlLnVwZGF0ZURvY3VtZW50KGFjLl9pZCwgYWMpO1xuICAgICAgICAgICAgdGhpcy5haXJjcmFmdCA9ICB0aGlzLmRhdGFiYXNlLmV4ZWN1dGVRdWVyeShcImFpcmNyYWZ0XCIpO1xuICAgIH1cblxufVxuIl19