"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var fleet_service_1 = require("../common/fleet.service");
var aircraft_service_1 = require("../common/aircraft.service");
var permissions_service_1 = require("../permissions.service");
var dialogs = require("ui/dialogs");
var AircraftDetailsComponent = /** @class */ (function () {
    function AircraftDetailsComponent(route, routerExtensions, aircraftService, permissionsService, fleetService) {
        this.route = route;
        this.routerExtensions = routerExtensions;
        this.aircraftService = aircraftService;
        this.permissionsService = permissionsService;
        this.fleetService = fleetService;
        this.hoursLeft = 0;
        this.daysLeft = 0;
        this.engineLeft = ['0', '0'];
        this.propLeft = ['0', '0'];
        this.hrsAlert = 0;
        this.daysAlert = 0;
        this.engAlert = [0, 0];
        this.propAlert = [0, 0];
    }
    AircraftDetailsComponent.prototype.ngOnInit = function () {
        var id = this.route.snapshot.params["id"];
        this.aircraft = this.fleetService.getAircraft(id);
        this.updateValues();
    };
    AircraftDetailsComponent.prototype.can = function (action) {
        return this.permissionsService.can(action);
    };
    AircraftDetailsComponent.prototype.getEngine = function (num) {
        var v = this.aircraft.engineHrsAtMaint[num].toString();
        if (v === '987654321') {
            v = 'OC';
        }
        return v;
    };
    AircraftDetailsComponent.prototype.getProp = function (num) {
        var v = this.aircraft.propHrsAtMaint[num].toString();
        if (v === '987654321') {
            v = 'OC';
        }
        return v;
    };
    AircraftDetailsComponent.prototype.setAlertStates = function () {
        this.hrsAlert = 0;
        if (this.hoursLeft < 10) {
            this.hrsAlert = 2;
        }
        else if (this.hoursLeft < 20) {
            this.hrsAlert = 1;
        }
        this.daysAlert = 0;
        if (this.daysLeft < 7) {
            this.daysAlert = 2;
        }
        else if (this.daysLeft < 14) {
            this.daysAlert = 1;
        }
        for (var i = 0; i < this.propLeft.length; i++) {
            this.engAlert[i] = 0;
            if (Number(this.engineLeft[i]) < 25) {
                this.engAlert[i] = 2;
            }
            else if (Number(this.engineLeft[i]) < 100) {
                this.engAlert[i] = 1;
            }
            this.propAlert[i] = 0;
            if (Number(this.propLeft[i]) < 25) {
                this.propAlert[i] = 2;
            }
            else if (Number(this.propLeft[i]) < 100) {
                this.propAlert[i] = 1;
            }
        }
    };
    AircraftDetailsComponent.prototype.updateValues = function () {
        this.hoursLeft = this.aircraftService.getHrsLeft(this.aircraft);
        this.daysLeft = this.aircraftService.getDaysLeft(this.aircraft);
        for (var i = 0; i < this.aircraft.engineHrsAtMaint.length; i++) {
            this.engineLeft[i] = this.aircraftService.getEngineLeft(this.aircraft, i + 1).toString();
            this.propLeft[i] = this.aircraftService.getPropLeft(this.aircraft, i + 1).toString();
            if (this.aircraft.engineHrsAtMaint[i] === 987654321) {
                this.engineLeft[i] = 'OC';
            }
            if (this.aircraft.propHrsAtMaint[i] === 987654321) {
                this.propLeft[i] = 'OC';
            }
        }
        this.setAlertStates();
    };
    AircraftDetailsComponent.prototype.adjustClockTime = function (args) {
        var textField = args.object;
        this.aircraft.clockTime = parseInt(textField.text);
    };
    AircraftDetailsComponent.prototype.adjustOffsetTime = function (args) {
        var textField = args.object;
        this.aircraft.clockOffset = parseInt(textField.text);
    };
    AircraftDetailsComponent.prototype.doubleConfirmDelete = function (ac) {
        var _this = this;
        dialogs.confirm({
            title: "Delete Aircraft",
            message: "If you enter Delete, " + ac.rego + " WILL BE DELETED!",
            okButtonText: "Keep " + ac.rego,
            cancelButtonText: "Delete",
        }).then(function (result) {
            if (!result) {
                _this.fleetService.deleteAircraft(ac._id);
                _this.routerExtensions.navigate(["/fleet"], { clearHistory: true });
            }
        });
    };
    AircraftDetailsComponent.prototype.deleteAircraft = function (ac) {
        var _this = this;
        dialogs.confirm({
            title: "Delete Aircraft",
            message: "Are you sure you want to delete " + ac.rego + "?",
            okButtonText: "Delete",
            cancelButtonText: "Keep " + ac.rego,
        }).then(function (result) {
            if (result) {
                _this.doubleConfirmDelete(ac);
            }
        });
    };
    AircraftDetailsComponent.prototype.clearMaintenanceItem = function (num) {
        var item = this.aircraft.maintenance[num];
        item.cleared = !item.cleared;
    };
    AircraftDetailsComponent.prototype.deleteMaintenanceItem = function (num) {
        var _this = this;
        var item = this.aircraft.maintenance[num];
        dialogs.confirm({
            title: "Delete Maintenance Item",
            message: "Are you sure you want to delete #" + (num + 1) + " " + item.maintenance + "?",
            okButtonText: "Delete",
            cancelButtonText: "Keep" + item.maintenance,
        }).then(function (result) {
            if (result) {
                _this.aircraft.maintenance.splice(num, 1);
            }
        });
    };
    AircraftDetailsComponent.prototype.getDateStringFromTuple = function (dt) {
        var st = "";
        if (dt !== undefined) {
            if (dt[0] !== undefined) {
                st = String(dt[0]);
            }
            if (dt[1] !== undefined) {
                st += '/' + String(dt[1]);
            }
            if (dt[2] !== undefined) {
                st += '/' + String(dt[2]);
            }
        }
        return st;
    };
    AircraftDetailsComponent.prototype.getDaysLeft = function (date) {
        var exDate = new Date(date[0], date[1] - 1, date[2]);
        var time = exDate.valueOf() - Date.now().valueOf();
        return Math.round(time / (24 * 60 * 60 * 1000));
    };
    AircraftDetailsComponent.prototype.getHoursLeft = function (hrs) {
        return Math.round((hrs - this.aircraft.ttis) * 10) / 10;
    };
    AircraftDetailsComponent.prototype.save = function (ac) {
        this.fleetService.updateAircraft(ac);
        this.routerExtensions.navigate(["/fleet"], { clearHistory: true });
    };
    AircraftDetailsComponent.prototype.onLoadDate = function (ev) {
        var datePicker = ev.object;
        if (this.aircraft.annualDateTuple[0] !== undefined) {
            datePicker.year = this.aircraft.annualDateTuple[0];
            datePicker.month = this.aircraft.annualDateTuple[1];
            datePicker.day = this.aircraft.annualDateTuple[2];
        }
    };
    AircraftDetailsComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'app-aircraft-details',
            templateUrl: './aircraft-details.component.html',
            styleUrls: ['./aircraft-details.component.scss']
        }),
        __metadata("design:paramtypes", [router_1.ActivatedRoute,
            router_2.RouterExtensions,
            aircraft_service_1.AircraftService,
            permissions_service_1.PermissionsService,
            fleet_service_1.FleetService])
    ], AircraftDetailsComponent);
    return AircraftDetailsComponent;
}());
exports.AircraftDetailsComponent = AircraftDetailsComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlyY3JhZnQtZGV0YWlscy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhaXJjcmFmdC1kZXRhaWxzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFrRDtBQUNsRCwwQ0FBaUQ7QUFDakQsc0RBQStEO0FBSy9ELHlEQUF1RDtBQUN2RCwrREFBNkQ7QUFDN0QsOERBQTREO0FBRTVELG9DQUFzQztBQVF0QztJQVlRLGtDQUFvQixLQUFxQixFQUNqQixnQkFBa0MsRUFDbEMsZUFBZ0MsRUFDaEMsa0JBQXNDLEVBQ3RDLFlBQTBCO1FBSjlCLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBQ2pCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFkMUMsY0FBUyxHQUFXLENBQUMsQ0FBQztRQUN0QixhQUFRLEdBQVcsQ0FBQyxDQUFDO1FBQ3JCLGVBQVUsR0FBYSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNsQyxhQUFRLEdBQWEsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEMsYUFBUSxHQUFXLENBQUMsQ0FBQztRQUNyQixjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBRTdCLGFBQVEsR0FBYSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNyQixjQUFTLEdBQWEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFPckMsQ0FBQztJQUVELDJDQUFRLEdBQVI7UUFDUSxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVELHNDQUFHLEdBQUgsVUFBSSxNQUFjO1FBQ1YsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVSLDRDQUFTLEdBQVQsVUFBVSxHQUFXO1FBQ3BCLElBQUksQ0FBQyxHQUFVLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDOUQsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDdkIsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUNWLENBQUM7UUFDRCxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ1YsQ0FBQztJQUVELDBDQUFPLEdBQVAsVUFBUSxHQUFXO1FBQ2xCLElBQUksQ0FBQyxHQUFVLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzVELEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDVixDQUFDO1FBQ0QsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNWLENBQUM7SUFFRCxpREFBYyxHQUFkO1FBQ1EsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7UUFDekIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLENBQUM7UUFDTSxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUMxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDcEIsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDcEIsQ0FBQztRQUVELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMvQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUM3QyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixDQUFDO1lBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFH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Q0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFELENBQUM7SUFDVCxDQUFDO0lBekxJLHdCQUF3QjtRQU5wQyxnQkFBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFFBQVEsRUFBRSxzQkFBc0I7WUFDaEMsV0FBVyxFQUFFLG1DQUFtQztZQUNoRCxTQUFTLEVBQUUsQ0FBQyxtQ0FBbUMsQ0FBQztTQUNqRCxDQUFDO3lDQWFpQyx1QkFBYztZQUNDLHlCQUFnQjtZQUNqQixrQ0FBZTtZQUNaLHdDQUFrQjtZQUN4Qiw0QkFBWTtPQWhCN0Msd0JBQXdCLENBMExwQztJQUFELCtCQUFDO0NBQUEsQUExTEQsSUEwTEM7QUExTFksNERBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xuaW1wb3J0IHsgUm91dGVyRXh0ZW5zaW9ucyB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IERhdGVQaWNrZXIgfSBmcm9tIFwidWkvZGF0ZS1waWNrZXJcIjtcbmltcG9ydCB7IFRleHRGaWVsZCB9IGZyb20gXCJ1aS90ZXh0LWZpZWxkXCI7XG5pbXBvcnQgeyBFdmVudERhdGEgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBBaXJjcmFmdCwgTWFpbnRlbmFuY2VJdGVtIH0gZnJvbSBcIi4uL2NvbW1vbi9haXJjcmFmdFwiO1xuaW1wb3J0IHsgRmxlZXRTZXJ2aWNlIH0gZnJvbSBcIi4uL2NvbW1vbi9mbGVldC5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBBaXJjcmFmdFNlcnZpY2UgfSBmcm9tIFwiLi4vY29tbW9uL2FpcmNyYWZ0LnNlcnZpY2VcIjtcbmltcG9ydCB7IFBlcm1pc3Npb25zU2VydmljZSB9IGZyb20gXCIuLi9wZXJtaXNzaW9ucy5zZXJ2aWNlXCI7XG5cbmltcG9ydCAqIGFzIGRpYWxvZ3MgZnJvbSBcInVpL2RpYWxvZ3NcIjtcblxuQENvbXBvbmVudCh7XG4gIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gIHNlbGVjdG9yOiAnYXBwLWFpcmNyYWZ0LWRldGFpbHMnLFxuICB0ZW1wbGF0ZVVybDogJy4vYWlyY3JhZnQtZGV0YWlscy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2FpcmNyYWZ0LWRldGFpbHMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBBaXJjcmFmdERldGFpbHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgICAgICBwcml2YXRlIGFpcmNyYWZ0OiBBaXJjcmFmdDtcbiAgICAgICAgcHJpdmF0ZSBob3Vyc0xlZnQ6IG51bWJlciA9IDA7XG4gICAgICAgIHByaXZhdGUgZGF5c0xlZnQ6IG51bWJlciA9IDA7XG4gICAgICAgIHByaXZhdGUgZW5naW5lTGVmdDogc3RyaW5nW10gPSBbJzAnLCAnMCddO1xuICAgICAgICBwcml2YXRlIHByb3BMZWZ0OiBzdHJpbmdbXSA9IFsnMCcsICcwJ107XG4gICAgICAgIHByaXZhdGUgaHJzQWxlcnQ6IG51bWJlciA9IDA7XG4gICAgICAgIHByaXZhdGUgZGF5c0FsZXJ0OiBudW1iZXIgPSAwO1xuXG5cdHByaXZhdGUgZW5nQWxlcnQ6IG51bWJlcltdID0gWzAsIDBdO1xuICAgICAgICBwcml2YXRlIHByb3BBbGVydDogbnVtYmVyW10gPSBbMCwgMF07XG5cbiAgICAgICAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcml2YXRlIHJvdXRlckV4dGVuc2lvbnM6IFJvdXRlckV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcml2YXRlIGFpcmNyYWZ0U2VydmljZTogQWlyY3JhZnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpdmF0ZSBwZXJtaXNzaW9uc1NlcnZpY2U6IFBlcm1pc3Npb25zU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgZmxlZXRTZXJ2aWNlOiBGbGVldFNlcnZpY2UpIHtcbiAgICAgICAgfVxuXG4gICAgICAgIG5nT25Jbml0KCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5wYXJhbXNbXCJpZFwiXTtcbiAgICAgICAgICAgICAgICB0aGlzLmFpcmNyYWZ0ID0gdGhpcy5mbGVldFNlcnZpY2UuZ2V0QWlyY3JhZnQoaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVmFsdWVzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjYW4oYWN0aW9uOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGVybWlzc2lvbnNTZXJ2aWNlLmNhbihhY3Rpb24pO1xuICAgICAgICB9XG5cblx0Z2V0RW5naW5lKG51bTogbnVtYmVyKSA6IHN0cmluZyB7XG5cdFx0bGV0IHY6c3RyaW5nID0gdGhpcy5haXJjcmFmdC5lbmdpbmVIcnNBdE1haW50W251bV0udG9TdHJpbmcoKTtcblx0XHRpZiAodiA9PT0gJzk4NzY1NDMyMScpIHtcblx0XHRcdHYgPSAnT0MnO1xuXHRcdH1cblx0XHRyZXR1cm4gdjtcblx0fVxuXG5cdGdldFByb3AobnVtOiBudW1iZXIpIDogc3RyaW5nIHtcblx0XHRsZXQgdjpzdHJpbmcgPSB0aGlzLmFpcmNyYWZ0LnByb3BIcnNBdE1haW50W251bV0udG9TdHJpbmcoKTtcblx0XHRpZiAodiA9PT0gJzk4NzY1NDMyMScpIHtcblx0XHRcdHYgPSAnT0MnO1xuXHRcdH1cblx0XHRyZXR1cm4gdjtcblx0fVxuXG5cdHNldEFsZXJ0U3RhdGVzKCkge1xuXHQgICAgICAgIHRoaXMuaHJzQWxlcnQgPSAwO1xuXHRcdGlmICh0aGlzLmhvdXJzTGVmdCA8IDEwKSB7XG5cdFx0XHR0aGlzLmhyc0FsZXJ0ID0gMjtcblx0XHR9IGVsc2UgaWYgKHRoaXMuaG91cnNMZWZ0IDwgMjApIHtcblx0XHRcdHRoaXMuaHJzQWxlcnQgPSAxO1xuXHRcdH1cblx0ICAgICAgICB0aGlzLmRheXNBbGVydCA9IDA7XG5cdFx0aWYgKHRoaXMuZGF5c0xlZnQgPCA3KSB7XG5cdFx0XHR0aGlzLmRheXNBbGVydCA9IDI7XG5cdFx0fSBlbHNlIGlmICh0aGlzLmRheXNMZWZ0IDwgMTQpIHtcblx0XHRcdHRoaXMuZGF5c0FsZXJ0ID0gMTtcblx0XHR9XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucHJvcExlZnQubGVuZ3RoOyBpKyspIHtcblx0XHRcdHRoaXMuZW5nQWxlcnRbaV0gPSAwO1xuXHRcdFx0aWYgKE51bWJlcih0aGlzLmVuZ2luZUxlZnRbaV0pIDwgMjUpIHtcblx0XHRcdFx0dGhpcy5lbmdBbGVydFtpXSA9IDI7XG5cdFx0XHR9IGVsc2UgaWYgKE51bWJlcih0aGlzLmVuZ2luZUxlZnRbaV0pIDwgMTAwKSB7XG5cdFx0XHRcdHRoaXMuZW5nQWxlcnRbaV0gPSAxO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5wcm9wQWxlcnRbaV0gPSAwO1xuXHRcdFx0aWYgKE51bWJlcih0aGlzLnByb3BMZWZ0W2ldKSA8IDI1KSB7XG5cdFx0XHRcdHRoaXMucHJvcEFsZXJ0W2ldID0gMjtcblx0XHRcdH0gZWxzZSBpZiAoTnVtYmVyKHRoaXMucHJvcExlZnRbaV0pIDwgMTAwKSB7XG5cdFx0XHRcdHRoaXMucHJvcEFsZXJ0W2ldID0gMTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuICAgICAgICB1cGRhdGVWYWx1ZXMoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob3Vyc0xlZnQgPSB0aGlzLmFpcmNyYWZ0U2VydmljZS5nZXRIcnNMZWZ0KHRoaXMuYWlyY3JhZnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGF5c0xlZnQgPSB0aGlzLmFpcmNyYWZ0U2VydmljZS5nZXREYXlzTGVmdCh0aGlzLmFpcmNyYWZ0KTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYWlyY3JhZnQuZW5naW5lSHJzQXRNYWludC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmdpbmVMZWZ0W2ldID0gdGhpcy5haXJjcmFmdFNlcnZpY2UuZ2V0RW5naW5lTGVmdCh0aGlzLmFpcmNyYWZ0LCBpKzEpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BMZWZ0W2ldID0gdGhpcy5haXJjcmFmdFNlcnZpY2UuZ2V0UHJvcExlZnQodGhpcy5haXJjcmFmdCwgaSsxKS50b1N0cmluZygpO1xuXHRcdFx0aWYgKHRoaXMuYWlyY3JhZnQuZW5naW5lSHJzQXRNYWludFtpXSA9PT0gOTg3NjU0MzIxKSB7XG5cdFx0XHRcdHRoaXMuZW5naW5lTGVmdFtpXSA9ICdPQyc7XG5cdFx0XHR9XG5cdFx0XHRpZiAodGhpcy5haXJjcmFmdC5wcm9wSHJzQXRNYWludFtpXSA9PT0gOTg3NjU0MzIxKSB7XG5cdFx0XHRcdHRoaXMucHJvcExlZnRbaV0gPSAnT0MnO1xuXHRcdFx0fVxuICAgICAgICAgICAgICAgIH1cblx0XHR0aGlzLnNldEFsZXJ0U3RhdGVzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBhZGp1c3RDbG9ja1RpbWUoYXJncykge1xuICAgICAgICAgICAgICAgIGxldCB0ZXh0RmllbGQgPSA8VGV4dEZpZWxkPmFyZ3Mub2JqZWN0O1xuICAgICAgICAgICAgICAgIHRoaXMuYWlyY3JhZnQuY2xvY2tUaW1lID0gcGFyc2VJbnQodGV4dEZpZWxkLnRleHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgYWRqdXN0T2Zmc2V0VGltZShhcmdzKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRleHRGaWVsZCA9IDxUZXh0RmllbGQ+YXJncy5vYmplY3Q7XG4gICAgICAgICAgICAgICAgdGhpcy5haXJjcmFmdC5jbG9ja09mZnNldCA9IHBhcnNlSW50KHRleHRGaWVsZC50ZXh0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvdWJsZUNvbmZpcm1EZWxldGUoYWM6IEFpcmNyYWZ0KSB7XG4gICAgICAgICAgICAgICAgZGlhbG9ncy5jb25maXJtKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkRlbGV0ZSBBaXJjcmFmdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJZiB5b3UgZW50ZXIgRGVsZXRlLCBcIiArIGFjLnJlZ28gKyBcIiBXSUxMIEJFIERFTEVURUQhXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBva0J1dHRvblRleHQ6IFwiS2VlcCBcIiArIGFjLnJlZ28sXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIkRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0OiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmxlZXRTZXJ2aWNlLmRlbGV0ZUFpcmNyYWZ0KGFjLl9pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIi9mbGVldFwiXSwgeyBjbGVhckhpc3Rvcnk6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xufVxuXG4gICAgICAgIGRlbGV0ZUFpcmNyYWZ0KGFjOiBBaXJjcmFmdCkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ3MuY29uZmlybSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJEZWxldGUgQWlyY3JhZnRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSBcIiArIGFjLnJlZ28gKyBcIj9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiS2VlcCBcIiArIGFjLnJlZ28sXG4gICAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0OiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvdWJsZUNvbmZpcm1EZWxldGUoYWMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNsZWFyTWFpbnRlbmFuY2VJdGVtKG51bTogbnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmFpcmNyYWZ0Lm1haW50ZW5hbmNlW251bV07XG4gICAgICAgICAgICAgICAgaXRlbS5jbGVhcmVkID0gISBpdGVtLmNsZWFyZWRcbiAgICAgICAgfVxuXG4gICAgICAgIGRlbGV0ZU1haW50ZW5hbmNlSXRlbShudW06IG51bWJlcikge1xuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5haXJjcmFmdC5tYWludGVuYW5jZVtudW1dO1xuICAgICAgICAgICAgICAgIGRpYWxvZ3MuY29uZmlybSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJEZWxldGUgTWFpbnRlbmFuY2UgSXRlbVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlICNcIiArIChudW0rMSkgKyBcIiBcIiArIGl0ZW0ubWFpbnRlbmFuY2UgKyBcIj9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9rQnV0dG9uVGV4dDogXCJEZWxldGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiS2VlcFwiICsgaXRlbS5tYWludGVuYW5jZSxcbiAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQ6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWlyY3JhZnQubWFpbnRlbmFuY2Uuc3BsaWNlKG51bSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIGdldERhdGVTdHJpbmdGcm9tVHVwbGUoZHQ6IG51bWJlcltdKTogc3RyaW5nIHtcbiAgICAgICAgICAgICAgICBsZXQgc3QgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGlmIChkdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHRbMF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdCA9IFN0cmluZyhkdFswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHRbMV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdCArPSAnLycgKyBTdHJpbmcoZHRbMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGR0WzJdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3QgKz0gJy8nICsgU3RyaW5nKGR0WzJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0O1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIGdldERheXNMZWZ0KGRhdGU6IG51bWJlcltdKTogbnVtYmVyIHtcbiAgICAgICAgICAgICAgICBsZXQgZXhEYXRlID0gbmV3IERhdGUoZGF0ZVswXSwgZGF0ZVsxXS0xLCBkYXRlWzJdKTtcbiAgICAgICAgICAgICAgICBsZXQgdGltZSA9IGV4RGF0ZS52YWx1ZU9mKCkgLSBEYXRlLm5vdygpLnZhbHVlT2YoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aW1lIC8gKDI0KjYwKjYwKjEwMDApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBnZXRIb3Vyc0xlZnQoaHJzOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKChocnMgLSB0aGlzLmFpcmNyYWZ0LnR0aXMpKjEwKS8xMDtcbiAgICAgICAgfVxuXG4gICAgICAgIHNhdmUoYWM6IEFpcmNyYWZ0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGVldFNlcnZpY2UudXBkYXRlQWlyY3JhZnQoYWMpO1xuICAgICAgICAgICAgICAgIHRoaXMucm91dGVyRXh0ZW5zaW9ucy5uYXZpZ2F0ZShbXCIvZmxlZXRcIl0sIHsgY2xlYXJIaXN0b3J5OiB0cnVlIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgb25Mb2FkRGF0ZShldikge1xuICAgICAgICAgICAgICAgIGxldCBkYXRlUGlja2VyID0gPERhdGVQaWNrZXI+ZXYub2JqZWN0O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFpcmNyYWZ0LmFubnVhbERhdGVUdXBsZVswXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlUGlja2VyLnllYXIgPSB0aGlzLmFpcmNyYWZ0LmFubnVhbERhdGVUdXBsZVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVQaWNrZXIubW9udGggPSB0aGlzLmFpcmNyYWZ0LmFubnVhbERhdGVUdXBsZVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVQaWNrZXIuZGF5ID0gdGhpcy5haXJjcmFmdC5hbm51YWxEYXRlVHVwbGVbMl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG59XG4iXX0=