"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_couchbase_1 = require("nativescript-couchbase");
var PermissionsService = /** @class */ (function () {
    function PermissionsService() {
        this.user = 'default';
        this.currentUserClass = 'default';
        this.knownUsers = {
            'admin': { group: 'admin', hash: '6789', email: 'jonathan.p.h.kelly@gmail.com' },
            'maintainer': { group: 'maintainer', hash: '6789', email: 'jonathan.p.h.kelly@gmail.com' },
            'pilot': { group: 'pilot', hash: '6789', email: 'jonathan.p.h.kelly@gmail.com' },
            'default': { group: 'default', hash: '6789', email: 'jonathan.p.h.kelly@gmail.com' }
        };
        this.permissionsStore = {
            'default': {
                'CAN_ADD_USER': false,
                'CAN_ADD_AIRCRAFT': false,
                'CAN_CHANGE_HOURS': false,
                'CAN_CLEAR_MR_ITEMS': false,
                'CAN_CHANGE_MR': false,
                'CAN_DELETE_AIRCRAFT': false,
                'CAN_DELETE_USER': false,
                'CAN_ADJUST_USER': false,
                'CAN_CHANGE_PW': false
            },
            'pilot': {
                'CAN_ADD_USER': false,
                'CAN_ADD_AIRCRAFT': false,
                'CAN_CHANGE_HOURS': true,
                'CAN_CLEAR_MR_ITEMS': true,
                'CAN_CHANGE_MR': false,
                'CAN_DELETE_AIRCRAFT': false,
                'CAN_DELETE_USER': false,
                'CAN_ADJUST_USER': false,
                'CAN_CHANGE_PW': true
            },
            'maintainer': {
                'CAN_ADD_USER': false,
                'CAN_ADD_AIRCRAFT': true,
                'CAN_CHANGE_HOURS': true,
                'CAN_CLEAR_MR_ITEMS': true,
                'CAN_CHANGE_MR': true,
                'CAN_DELETE_AIRCRAFT': true,
                'CAN_DELETE_USER': false,
                'CAN_ADJUST_USER': false,
                'CAN_CHANGE_PW': true
            },
            'admin': {
                'CAN_ADD_USER': true,
                'CAN_ADD_AIRCRAFT': true,
                'CAN_CHANGE_HOURS': true,
                'CAN_CLEAR_MR_ITEMS': true,
                'CAN_CHANGE_MR': true,
                'CAN_DELETE_AIRCRAFT': true,
                'CAN_DELETE_USER': true,
                'CAN_ADJUST_USER': true,
                'CAN_CHANGE_PW': true
            }
        };
        this.database = new nativescript_couchbase_1.Couchbase("users-database");
        var push = this.database.createPushReplication("http://mcap.australiaeast.cloudapp.azure.com:4984/mcusers");
        var pull = this.database.createPullReplication("http://mcap.australiaeast.cloudapp.azure.com:4984/mcusers");
        pull.setContinuous(true);
        push.setContinuous(true);
        pull.start();
        push.start();
        var documentId = this.database.createDocument({
            "test": 1,
            "record": 2
        });
        console.log(documentId);
    }
    PermissionsService.prototype.addNewUser = function (user, pw, userClass) {
        var hash = this.hashPw(pw);
        this.knownUsers[user] = { group: userClass, hash: hash, email: 'jonathan.p.h.kelly@gmail.com' };
    };
    PermissionsService.prototype.can = function (item) {
        return this.checkPerms(this.currentUserClass, item);
    };
    PermissionsService.prototype.checkPerms = function (userClass, item) {
        if (this.permissionsStore[userClass] === undefined) {
            alert('user class: ' + item + ' not known');
            return false;
        }
        if (this.permissionsStore[userClass][item] !== undefined) {
            return this.permissionsStore[userClass][item];
        }
        alert('do not know permission: ' + item + ' for user class: ' + userClass);
        return false;
    };
    PermissionsService.prototype.deleteUser = function (user) {
        delete this.knownUsers[user];
    };
    PermissionsService.prototype.getClassOfUser = function (user) {
        if (this.knownUsers[user] !== undefined) {
            return this.knownUsers[user].group;
        }
        return 'default';
    };
    PermissionsService.prototype.getCurrentUser = function () {
        return this.user;
    };
    PermissionsService.prototype.getCurrentUserClass = function () {
        return this.currentUserClass;
    };
    PermissionsService.prototype.getUserNames = function () {
        return Object.keys(this.knownUsers);
    };
    PermissionsService.prototype.hashPw = function (pw) {
        return pw;
    };
    PermissionsService.prototype.isAdminAccess = function () {
        return (this.getCurrentUser() === 'admin');
    };
    PermissionsService.prototype.logOut = function () {
    };
    PermissionsService.prototype.setCurrentUserClass = function (userClass) {
        this.currentUserClass = userClass;
    };
    PermissionsService.prototype.setUser = function (user) {
        if (this.knownUsers[user] !== undefined) {
            this.user = user;
        }
        else {
            alert('I do not know: ' + user + '. Using default access');
            this.user = 'default';
        }
        this.setCurrentUserClass(this.getClassOfUser(this.user));
        console.log(user, this.permissionsStore[this.currentUserClass]);
    };
    PermissionsService.prototype.setUserClass = function (user, group) {
        this.knownUsers[user].group = group;
    };
    PermissionsService.prototype.setUserPw = function (user, pw) {
        this.knownUsers[user].hash = this.hashPw(pw);
    };
    PermissionsService.prototype.setPerms = function (userClass, item, value) {
        if (this.permissionsStore[userClass] !== undefined) {
            if (this.permissionsStore[userClass][item] === undefined) {
                alert('adding new permission: ' + item + ' for user class: ' + userClass);
            }
            this.permissionsStore[userClass][item] = value;
        }
        else {
            alert('user class: ' + item + ' not known');
        }
    };
    PermissionsService.prototype.userExists = function (user) {
        return (this.knownUsers[user] !== undefined);
    };
    PermissionsService.prototype.validateUser = function (user, pwHash) {
        if (this.userExists(user)) {
            return (this.knownUsers[user].hash === pwHash);
        }
        return false;
    };
    PermissionsService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], PermissionsService);
    return PermissionsService;
}());
exports.PermissionsService = PermissionsService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVybWlzc2lvbnMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBlcm1pc3Npb25zLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsaUVBQWlEO0FBR2pEO0lBNERFO1FBMURRLFNBQUksR0FBVyxTQUFTLENBQUM7UUFDekIscUJBQWdCLEdBQVcsU0FBUyxDQUFDO1FBQ3JDLGVBQVUsR0FBUTtZQUNwQixPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLDhCQUE4QixFQUFFO1lBQ2hGLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsOEJBQThCLEVBQUU7WUFDMUYsT0FBTyxFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSw4QkFBOEIsRUFBRTtZQUNoRixTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLDhCQUE4QixFQUFFO1NBQ3pGLENBQUM7UUFFTSxxQkFBZ0IsR0FBUTtZQUMxQixTQUFTLEVBQUU7Z0JBQ0gsY0FBYyxFQUFFLEtBQUs7Z0JBQ3JCLGtCQUFrQixFQUFFLEtBQUs7Z0JBQ3pCLGtCQUFrQixFQUFFLEtBQUs7Z0JBQ3pCLG9CQUFvQixFQUFFLEtBQUs7Z0JBQzNCLGVBQWUsRUFBRSxLQUFLO2dCQUN0QixxQkFBcUIsRUFBRSxLQUFLO2dCQUM1QixpQkFBaUIsRUFBRSxLQUFLO2dCQUN4QixpQkFBaUIsRUFBRSxLQUFLO2dCQUN4QixlQUFlLEVBQUUsS0FBSzthQUM3QjtZQUNELE9BQU8sRUFBRTtnQkFDRCxjQUFjLEVBQUUsS0FBSztnQkFDckIsa0JBQWtCLEVBQUUsS0FBSztnQkFDekIsa0JBQWtCLEVBQUUs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UyxDQUFDLENBQUMsQ0FBQztnQkFDbkQsS0FBSyxDQUFDLHlCQUF5QixHQUFHLElBQUksR0FBRyxtQkFBbUIsR0FBRyxTQUFTLENBQUMsQ0FBQztZQUNsRixDQUFDO1lBQ0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUN2RCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDQSxLQUFLLENBQUMsY0FBYyxHQUFHLElBQUksR0FBRyxZQUFZLENBQUMsQ0FBQztRQUNwRCxDQUFDO0lBQ1AsQ0FBQztJQUVELHVDQUFVLEdBQVYsVUFBVyxJQUFZO1FBQ2pCLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELHlDQUFZLEdBQVosVUFBYSxJQUFZLEVBQUUsTUFBYztRQUNuQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQixNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQztRQUN2RCxDQUFDO1FBQ0QsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNuQixDQUFDO0lBbExVLGtCQUFrQjtRQUQ5QixpQkFBVSxFQUFFOztPQUNBLGtCQUFrQixDQW9MOUI7SUFBRCx5QkFBQztDQUFBLEFBcExELElBb0xDO0FBcExZLGdEQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q291Y2hiYXNlfSBmcm9tICduYXRpdmVzY3JpcHQtY291Y2hiYXNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBlcm1pc3Npb25zU2VydmljZSB7XG5cbiAgcHJpdmF0ZSB1c2VyOiBzdHJpbmcgPSAnZGVmYXVsdCc7XG4gIHByaXZhdGUgY3VycmVudFVzZXJDbGFzczogc3RyaW5nID0gJ2RlZmF1bHQnO1xuICBwcml2YXRlIGtub3duVXNlcnM6IGFueSA9IHtcbiAgICAgICAgJ2FkbWluJzogeyBncm91cDogJ2FkbWluJywgaGFzaDogJzY3ODknLCBlbWFpbDogJ2pvbmF0aGFuLnAuaC5rZWxseUBnbWFpbC5jb20nIH0sXG4gICAgICAgICdtYWludGFpbmVyJzogeyBncm91cDogJ21haW50YWluZXInLCBoYXNoOiAnNjc4OScsIGVtYWlsOiAnam9uYXRoYW4ucC5oLmtlbGx5QGdtYWlsLmNvbScgfSxcbiAgICAgICAgJ3BpbG90JzogeyBncm91cDogJ3BpbG90JywgaGFzaDogJzY3ODknLCBlbWFpbDogJ2pvbmF0aGFuLnAuaC5rZWxseUBnbWFpbC5jb20nIH0sXG4gICAgICAgICdkZWZhdWx0JzogeyBncm91cDogJ2RlZmF1bHQnLCBoYXNoOiAnNjc4OScsIGVtYWlsOiAnam9uYXRoYW4ucC5oLmtlbGx5QGdtYWlsLmNvbScgfVxuICB9O1xuXG4gIHByaXZhdGUgcGVybWlzc2lvbnNTdG9yZTogYW55ID0ge1xuICAgICAgICAnZGVmYXVsdCc6IHtcbiAgICAgICAgICAgICAgICAnQ0FOX0FERF9VU0VSJzogZmFsc2UsXG4gICAgICAgICAgICAgICAgJ0NBTl9BRERfQUlSQ1JBRlQnOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9IT1VSUyc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICdDQU5fQ0xFQVJfTVJfSVRFTVMnOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9NUic6IGZhbHNlLFxuICAgICAgICAgICAgICAgICdDQU5fREVMRVRFX0FJUkNSQUZUJzogZmFsc2UsXG4gICAgICAgICAgICAgICAgJ0NBTl9ERUxFVEVfVVNFUic6IGZhbHNlLFxuICAgICAgICAgICAgICAgICdDQU5fQURKVVNUX1VTRVInOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9QVyc6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgICdwaWxvdCc6IHtcbiAgICAgICAgICAgICAgICAnQ0FOX0FERF9VU0VSJzogZmFsc2UsXG4gICAgICAgICAgICAgICAgJ0NBTl9BRERfQUlSQ1JBRlQnOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9IT1VSUyc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ0NBTl9DTEVBUl9NUl9JVEVNUyc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ0NBTl9DSEFOR0VfTVInOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0RFTEVURV9BSVJDUkFGVCc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICdDQU5fREVMRVRFX1VTRVInOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0FESlVTVF9VU0VSJzogZmFsc2UsXG4gICAgICAgICAgICAgICAgJ0NBTl9DSEFOR0VfUFcnOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgICdtYWludGFpbmVyJzoge1xuICAgICAgICAgICAgICAgICdDQU5fQUREX1VTRVInOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0FERF9BSVJDUkFGVCc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ0NBTl9DSEFOR0VfSE9VUlMnOiB0cnVlLFxuICAgICAgICAgICAgICAgICdDQU5fQ0xFQVJfTVJfSVRFTVMnOiB0cnVlLFxuICAgICAgICAgICAgICAgICdDQU5fQ0hBTkdFX01SJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0RFTEVURV9BSVJDUkFGVCc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ0NBTl9ERUxFVEVfVVNFUic6IGZhbHNlLFxuICAgICAgICAgICAgICAgICdDQU5fQURKVVNUX1VTRVInOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9QVyc6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgJ2FkbWluJzoge1xuICAgICAgICAgICAgICAgICdDQU5fQUREX1VTRVInOiB0cnVlLFxuICAgICAgICAgICAgICAgICdDQU5fQUREX0FJUkNSQUZUJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9IT1VSUyc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ0NBTl9DTEVBUl9NUl9JVEVNUyc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ0NBTl9DSEFOR0VfTVInOiB0cnVlLFxuICAgICAgICAgICAgICAgICdDQU5fREVMRVRFX0FJUkNSQUZUJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0RFTEVURV9VU0VSJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0FESlVTVF9VU0VSJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAnQ0FOX0NIQU5HRV9QVyc6IHRydWVcbiAgICAgICAgfVxuICB9O1xuXG4gIHB1YmxpYyBkYXRhYmFzZTogYW55O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlID0gbmV3IENvdWNoYmFzZShcInVzZXJzLWRhdGFiYXNlXCIpO1xuICAgICAgICBsZXQgcHVzaCA9IHRoaXMuZGF0YWJhc2UuY3JlYXRlUHVzaFJlcGxpY2F0aW9uKFwiaHR0cDovL21jYXAuYXVzdHJhbGlhZWFzdC5jbG91ZGFwcC5henVyZS5jb206NDk4NC9tY3VzZXJzXCIpO1xuICAgICAgICBsZXQgcHVsbCA9IHRoaXMuZGF0YWJhc2UuY3JlYXRlUHVsbFJlcGxpY2F0aW9uKFwiaHR0cDovL21jYXAuYXVzdHJhbGlhZWFzdC5jbG91ZGFwcC5henVyZS5jb206NDk4NC9tY3VzZXJzXCIpO1xuXG4gICAgICAgIHB1bGwuc2V0Q29udGludW91cyh0cnVlKTtcbiAgICAgICAgcHVzaC5zZXRDb250aW51b3VzKHRydWUpO1xuXG4gICAgICAgIHB1bGwuc3RhcnQoKTtcbiAgICAgICAgcHVzaC5zdGFydCgpO1xuXG4gICAgICAgIGxldCBkb2N1bWVudElkID0gdGhpcy5kYXRhYmFzZS5jcmVhdGVEb2N1bWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXN0XCI6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyZWNvcmRcIjogMlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZyhkb2N1bWVudElkKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGROZXdVc2VyKHVzZXI6IHN0cmluZywgcHc6IHN0cmluZywgdXNlckNsYXNzOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGhhc2ggPSB0aGlzLmhhc2hQdyhwdyk7XG4gICAgICAgIHRoaXMua25vd25Vc2Vyc1t1c2VyXSA9IHtncm91cDogdXNlckNsYXNzLCBoYXNoOiBoYXNoLCBlbWFpbDogJ2pvbmF0aGFuLnAuaC5rZWxseUBnbWFpbC5jb20nIH07XG4gIH1cblxuICBwdWJsaWMgY2FuKGl0ZW06IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja1Blcm1zKHRoaXMuY3VycmVudFVzZXJDbGFzcywgaXRlbSk7XG4gIH1cblxuICBwdWJsaWMgY2hlY2tQZXJtcyh1c2VyQ2xhc3M6IHN0cmluZywgaXRlbTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLnBlcm1pc3Npb25zU3RvcmVbdXNlckNsYXNzXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoJ3VzZXIgY2xhc3M6ICcgKyBpdGVtICsgJyBub3Qga25vd24nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGVybWlzc2lvbnNTdG9yZVt1c2VyQ2xhc3NdW2l0ZW1dICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wZXJtaXNzaW9uc1N0b3JlW3VzZXJDbGFzc11baXRlbV07XG4gICAgICAgIH1cbiAgICAgICAgYWxlcnQoJ2RvIG5vdCBrbm93IHBlcm1pc3Npb246ICcgKyBpdGVtICsgJyBmb3IgdXNlciBjbGFzczogJyArIHVzZXJDbGFzcyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGVVc2VyKHVzZXI6IHN0cmluZykge1xuICAgICAgICBkZWxldGUgdGhpcy5rbm93blVzZXJzW3VzZXJdO1xuICB9XG5cblxuICBwdWJsaWMgZ2V0Q2xhc3NPZlVzZXIodXNlcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMua25vd25Vc2Vyc1t1c2VyXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMua25vd25Vc2Vyc1t1c2VyXS5ncm91cDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ2RlZmF1bHQnO1xuICB9XG5cbiAgcHVibGljIGdldEN1cnJlbnRVc2VyKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnVzZXI7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q3VycmVudFVzZXJDbGFzcygpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlckNsYXNzO1xuICB9XG5cbiAgcHVibGljIGdldFVzZXJOYW1lcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLmtub3duVXNlcnMpO1xuICB9XG5cbiAgcHVibGljIGhhc2hQdyhwdzogc3RyaW5nKSA6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBwdztcbiAgfVxuXG4gIGlzQWRtaW5BY2Nlc3MoKSB7XG4gICAgICAgIHJldHVybiAgKHRoaXMuZ2V0Q3VycmVudFVzZXIoKSA9PT0gJ2FkbWluJyk7XG4gIH1cblxuICBwdWJsaWMgbG9nT3V0KCkge1xuICB9XG5cbiAgcHVibGljIHNldEN1cnJlbnRVc2VyQ2xhc3ModXNlckNsYXNzOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlckNsYXNzID0gdXNlckNsYXNzO1xuICB9XG5cbiAgcHVibGljIHNldFVzZXIodXNlcjogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLmtub3duVXNlcnNbdXNlcl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXNlciA9IHVzZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoJ0kgZG8gbm90IGtub3c6ICcgKyB1c2VyICsgJy4gVXNpbmcgZGVmYXVsdCBhY2Nlc3MnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXIgPSAnZGVmYXVsdCdcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldEN1cnJlbnRVc2VyQ2xhc3ModGhpcy5nZXRDbGFzc09mVXNlcih0aGlzLnVzZXIpKTtcbiAgICAgICAgY29uc29sZS5sb2codXNlciwgdGhpcy5wZXJtaXNzaW9uc1N0b3JlW3RoaXMuY3VycmVudFVzZXJDbGFzc10pO1xuICB9XG5cbiAgcHVibGljIHNldFVzZXJDbGFzcyh1c2VyOiBzdHJpbmcsIGdyb3VwOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5rbm93blVzZXJzW3VzZXJdLmdyb3VwID0gZ3JvdXA7XG4gIH1cblxuICBwdWJsaWMgc2V0VXNlclB3KHVzZXI6IHN0cmluZywgcHc6IHN0cmluZykge1xuICAgICAgICB0aGlzLmtub3duVXNlcnNbdXNlcl0uaGFzaCA9IHRoaXMuaGFzaFB3KHB3KTtcbiAgfVxuXG5cbiAgcHVibGljIHNldFBlcm1zKHVzZXJDbGFzczogc3RyaW5nLCBpdGVtOiBzdHJpbmcsIHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGlmICh0aGlzLnBlcm1pc3Npb25zU3RvcmVbdXNlckNsYXNzXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGVybWlzc2lvbnNTdG9yZVt1c2VyQ2xhc3NdW2l0ZW1dID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdhZGRpbmcgbmV3IHBlcm1pc3Npb246ICcgKyBpdGVtICsgJyBmb3IgdXNlciBjbGFzczogJyArIHVzZXJDbGFzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucGVybWlzc2lvbnNTdG9yZVt1c2VyQ2xhc3NdW2l0ZW1dID0gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoJ3VzZXIgY2xhc3M6ICcgKyBpdGVtICsgJyBub3Qga25vd24nKTtcbiAgICAgICAgfVxuICB9XG5cbiAgdXNlckV4aXN0cyh1c2VyOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodGhpcy5rbm93blVzZXJzW3VzZXJdICE9PSB1bmRlZmluZWQpO1xuICB9XG5cbiAgdmFsaWRhdGVVc2VyKHVzZXI6IHN0cmluZywgcHdIYXNoOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLnVzZXJFeGlzdHModXNlcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMua25vd25Vc2Vyc1t1c2VyXS5oYXNoID09PSBwd0hhc2gpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG59XG4iXX0=